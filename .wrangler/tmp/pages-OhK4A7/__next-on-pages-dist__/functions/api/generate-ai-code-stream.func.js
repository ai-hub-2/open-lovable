var yt=Object.defineProperty;var It=Object.getOwnPropertyDescriptor;var vt=Object.getOwnPropertyNames;var Lt=Object.prototype.hasOwnProperty;var Pt=(U,u)=>()=>(U&&(u=U(U=0)),u);var at=(U,u,je,Q)=>{if(u&&typeof u=="object"||typeof u=="function")for(let Z of vt(u))!Lt.call(U,Z)&&Z!==je&&yt(U,Z,{get:()=>u[Z],enumerable:!(Q=It(u,Z))||Q.enumerable});return U},it=(U,u,je)=>(at(U,u,"default"),je&&at(je,u,"default"));var Dt=U=>at(yt({},"__esModule",{value:!0}),U);var Ge={};import*as So from"async_hooks";var xt=Pt(()=>{it(Ge,So)});import{__getNamedExports as jt}from"../../../__next-on-pages-dist__/webpack/71ff79c606208bcc79e439670b104d2a.js";import{__getNamedExports as Ft}from"../../../__next-on-pages-dist__/webpack/5492.js";import{__getNamedExports as Ut}from"../../../__next-on-pages-dist__/webpack/def5e988b259bee68b84738b0b523c04.js";import{__getNamedExports as Mt}from"../../../__next-on-pages-dist__/manifest/88a389dd6c068190adb2efc795e4063c.js";var se=globalThis.__nextOnPagesRoutesIsolation.getProxyFor("/api/generate-ai-code-stream"),e=jt(se,se,se),Yt=e.__chunk_9127,Ht=e.__chunk_5521,$t=e.__chunk_5356,Wt=e.__chunk_975,qt=e.__chunk_9756,Vt=e.__chunk_9614,Gt=e.__chunk_9542,Xt=e.__chunk_9441,Bt=e.__chunk_9412,Kt=e.__chunk_9249,zt=e.__chunk_9146,Jt=e.__chunk_8952,Qt=e.__chunk_8948,Zt=e.__chunk_8903,en=e.__chunk_8877,tn=e.__chunk_8818,nn=e.__chunk_8807,sn=e.__chunk_8733,on=e.__chunk_8637,an=e.__chunk_8561,rn=e.__chunk_8538,cn=e.__chunk_8468,ln=e.__chunk_8455,dn=e.__chunk_8312,un=e.__chunk_8311,pn=e.__chunk_8289,hn=e.__chunk_8246,mn=e.__chunk_8183,fn=e.__chunk_8146,_n=e.__chunk_8105,gn=e.__chunk_8051,En=e.__chunk_7992,yn=e.__chunk_7762,xn=e.__chunk_7724,kn=e.__chunk_7671,Tn=e.__chunk_7329,Nn=e.__chunk_7254,wn=e.__chunk_7149,On=e.__chunk_7078,bn=e.__chunk_7066,Cn=e.__chunk_6941,Rn=e.__chunk_6899,An=e.__chunk_6825,Sn=e.__chunk_6753,In=e.__chunk_6597,vn=e.__chunk_6487,Ln=e.__chunk_6466,Pn=e.__chunk_6463,Dn=e.__chunk_6399,jn=e.__chunk_6276,Fn=e.__chunk_6244,Un=e.__chunk_6233,Mn=e.__chunk_6161,Yn=e.__chunk_5988,Hn=e.__chunk_5951,$n=e.__chunk_5931,Wn=e.__chunk_5813,qn=e.__chunk_5807,Vn=e.__chunk_5759,Gn=e.__chunk_5697,Xn=e.__chunk_5687,Bn=e.__chunk_5626,Kn=e.__chunk_5582,zn=e.__chunk_5467,Jn=e.__chunk_5431,Qn=e.__chunk_5295,Zn=e.__chunk_5275,es=e.__chunk_5214,ts=e.__chunk_5205,ns=e.__chunk_5156,ss=e.__chunk_5123,os=e.__chunk_5115,as=e.__chunk_5108,is=e.__chunk_4962,rs=e.__chunk_4838,cs=e.__chunk_4799,ls=e.__chunk_4604,ds=e.__chunk_4600,us=e.__chunk_4452,ps=e.__chunk_4442,hs=e.__chunk_4171,ms=e.__chunk_4084,fs=e.__chunk_3560,_s=e.__chunk_3481,gs=e.__chunk_3464,Es=e.__chunk_3389,ys=e.__chunk_3282,xs=e.__chunk_2978,ks=e.__chunk_2975,Ts=e.__chunk_2724,Ns=e.__chunk_2555,ws=e.__chunk_2500,Os=e.__chunk_2452,bs=e.__chunk_2354,Cs=e.__chunk_2338,Rs=e.__chunk_2231,As=e.__chunk_2052,Ss=e.__chunk_2009,Is=e.__chunk_1755,vs=e.__chunk_1728,Ls=e.__chunk_1669,Ps=e.__chunk_1450,Ds=e.__chunk_1415,js=e.__chunk_1357,Fs=e.__chunk_1350,Us=e.__chunk_1114,Ms=e.__chunk_1012,Ys=e.__chunk_981,Hs=e.__chunk_816,$s=e.__chunk_773,Ws=e.__chunk_555,qs=e.__chunk_482,Vs=e.__chunk_471,Gs=e.__chunk_315,Xs=e.__chunk_311,Bs=e.__chunk_305,Ks=e.__chunk_297,zs=e.__chunk_143,Js=e.__chunk_137,Qs=Ft(se,se,se),Zs=Qs.__chunk_5492,Y=Ut(se,se,se),eo=Y.__chunk_9502,to=Y.__chunk_9349,no=Y.__chunk_9245,so=Y.__chunk_9182,oo=Y.__chunk_9068,ao=Y.__chunk_9056,io=Y.__chunk_9054,ro=Y.__chunk_6933,co=Y.__chunk_6479,lo=Y.__chunk_6172,uo=Y.__chunk_5985,po=Y.__chunk_5878,ho=Y.__chunk_5579,mo=Y.__chunk_5371,fo=Y.__chunk_4236,_o=Y.__chunk_4215,go=Y.__chunk_4008,Eo=Y.__chunk_2892,yo=Y.__chunk_2627,xo=Y.__chunk_1826,ko=Y.__chunk_1605,To=Y.__chunk_1600,No=Y.__chunk_1582,wo=Y.__chunk_1011,Oo=Y.__chunk_683,rt=Mt(se,se,se),bo=rt.__NEXT_FONT_MANIFEST,Co=rt.__REACT_LOADABLE_MANIFEST,Ro=rt.__RSC_SERVER_MANIFEST,Do=((U,u,je)=>(u._ENTRIES={},U.__RSC_SERVER_MANIFEST=Ro,u.__RSC_MANIFEST=u.__RSC_MANIFEST||{},u.__RSC_MANIFEST["/api/generate-ai-code-stream/route"]={moduleLoading:{prefix:"/_next/"},ssrModuleMapping:{239:{"*":{id:"9715",name:"*",chunks:[],async:!1}},563:{"*":{id:"3443",name:"*",chunks:[],async:!1}},649:{"*":{id:"2935",name:"*",chunks:[],async:!1}},1183:{"*":{id:"7267",name:"*",chunks:[],async:!1}},4142:{"*":{id:"9226",name:"*",chunks:[],async:!1}},4969:{"*":{id:"9915",name:"*",chunks:[],async:!1}},6671:{"*":{id:"2533",name:"*",chunks:[],async:!1}},6986:{"*":{id:"6212",name:"*",chunks:[],async:!1}},7393:{"*":{id:"5851",name:"*",chunks:[],async:!1}},9615:{"*":{id:"6763",name:"*",chunks:[],async:!1}}},edgeSSRModuleMapping:{},clientModules:{"/workspace/node_modules/.pnpm/next@15.4.3_@opentelemetry+api@1.9.0_react-dom@19.1.0_react@19.1.0__react@19.1.0/node_modules/next/dist/client/components/builtin/global-error.js":{id:4969,name:"*",chunks:[],async:!1},"/workspace/node_modules/.pnpm/next@15.4.3_@opentelemetry+api@1.9.0_react-dom@19.1.0_react@19.1.0__react@19.1.0/node_modules/next/dist/esm/client/components/builtin/global-error.js":{id:4969,name:"*",chunks:[],async:!1},"/workspace/node_modules/.pnpm/next@15.4.3_@opentelemetry+api@1.9.0_react-dom@19.1.0_react@19.1.0__react@19.1.0/node_modules/next/dist/client/components/client-page.js":{id:4142,name:"*",chunks:[],async:!1},"/workspace/node_modules/.pnpm/next@15.4.3_@opentelemetry+api@1.9.0_react-dom@19.1.0_react@19.1.0__react@19.1.0/node_modules/next/dist/esm/client/components/client-page.js":{id:4142,name:"*",chunks:[],async:!1},"/workspace/node_modules/.pnpm/next@15.4.3_@opentelemetry+api@1.9.0_react-dom@19.1.0_react@19.1.0__react@19.1.0/node_modules/next/dist/client/components/client-segment.js":{id:6986,name:"*",chunks:[],async:!1},"/workspace/node_modules/.pnpm/next@15.4.3_@opentelemetry+api@1.9.0_react-dom@19.1.0_react@19.1.0__react@19.1.0/node_modules/next/dist/esm/client/components/client-segment.js":{id:6986,name:"*",chunks:[],async:!1},"/workspace/node_modules/.pnpm/next@15.4.3_@opentelemetry+api@1.9.0_react-dom@19.1.0_react@19.1.0__react@19.1.0/node_modules/next/dist/client/components/http-access-fallback/error-boundary.js":{id:239,name:"*",chunks:[],async:!1},"/workspace/node_modules/.pnpm/next@15.4.3_@opentelemetry+api@1.9.0_react-dom@19.1.0_react@19.1.0__react@19.1.0/node_modules/next/dist/esm/client/components/http-access-fallback/error-boundary.js":{id:239,name:"*",chunks:[],async:!1},"/workspace/node_modules/.pnpm/next@15.4.3_@opentelemetry+api@1.9.0_react-dom@19.1.0_react@19.1.0__react@19.1.0/node_modules/next/dist/client/components/layout-router.js":{id:563,name:"*",chunks:[],async:!1},"/workspace/node_modules/.pnpm/next@15.4.3_@opentelemetry+api@1.9.0_react-dom@19.1.0_react@19.1.0__react@19.1.0/node_modules/next/dist/esm/client/components/layout-router.js":{id:563,name:"*",chunks:[],async:!1},"/workspace/node_modules/.pnpm/next@15.4.3_@opentelemetry+api@1.9.0_react-dom@19.1.0_react@19.1.0__react@19.1.0/node_modules/next/dist/client/components/metadata/async-metadata.js":{id:9615,name:"*",chunks:[],async:!1},"/workspace/node_modules/.pnpm/next@15.4.3_@opentelemetry+api@1.9.0_react-dom@19.1.0_react@19.1.0__react@19.1.0/node_modules/next/dist/esm/client/components/metadata/async-metadata.js":{id:9615,name:"*",chunks:[],async:!1},"/workspace/node_modules/.pnpm/next@15.4.3_@opentelemetry+api@1.9.0_react-dom@19.1.0_react@19.1.0__react@19.1.0/node_modules/next/dist/client/components/metadata/metadata-boundary.js":{id:7393,name:"*",chunks:[],async:!1},"/workspace/node_modules/.pnpm/next@15.4.3_@opentelemetry+api@1.9.0_react-dom@19.1.0_react@19.1.0__react@19.1.0/node_modules/next/dist/esm/client/components/metadata/metadata-boundary.js":{id:7393,name:"*",chunks:[],async:!1},"/workspace/node_modules/.pnpm/next@15.4.3_@opentelemetry+api@1.9.0_react-dom@19.1.0_react@19.1.0__react@19.1.0/node_modules/next/dist/client/components/render-from-template-context.js":{id:6671,name:"*",chunks:[],async:!1},"/workspace/node_modules/.pnpm/next@15.4.3_@opentelemetry+api@1.9.0_react-dom@19.1.0_react@19.1.0__react@19.1.0/node_modules/next/dist/esm/client/components/render-from-template-context.js":{id:6671,name:"*",chunks:[],async:!1},"/workspace/node_modules/.pnpm/next@15.4.3_@opentelemetry+api@1.9.0_react-dom@19.1.0_react@19.1.0__react@19.1.0/node_modules/next/dist/lib/metadata/generate/icon-mark.js":{id:1183,name:"*",chunks:[],async:!1},"/workspace/node_modules/.pnpm/next@15.4.3_@opentelemetry+api@1.9.0_react-dom@19.1.0_react@19.1.0__react@19.1.0/node_modules/next/dist/esm/lib/metadata/generate/icon-mark.js":{id:1183,name:"*",chunks:[],async:!1},'/workspace/node_modules/.pnpm/next@15.4.3_@opentelemetry+api@1.9.0_react-dom@19.1.0_react@19.1.0__react@19.1.0/node_modules/next/font/google/target.css?{"path":"app/layout.tsx","import":"Inter","arguments":[{"subsets":["latin"]}],"variableName":"inter"}':{id:171,name:"*",chunks:["177","static/chunks/app/layout-3782b268ecdeb8d5.js"],async:!1},"/workspace/app/globals.css":{id:5644,name:"*",chunks:["177","static/chunks/app/layout-3782b268ecdeb8d5.js"],async:!1},"/workspace/app/page.tsx":{id:649,name:"*",chunks:["974","static/chunks/app/page-669b50c51373d102.js"],async:!1}},entryCSSFiles:{"/workspace/":[],"/workspace/app/layout":[{inlined:!1,path:"static/css/bf21f89961c515c5.css"}],"/workspace/app/page":[],"/workspace/app/api/generate-ai-code-stream/route":[]},rscModuleMapping:{239:{"*":{id:"8037",name:"*",chunks:[],async:!1}},563:{"*":{id:"9313",name:"*",chunks:[],async:!1}},649:{"*":{id:"9901",name:"*",chunks:[],async:!1}},1183:{"*":{id:"2849",name:"*",chunks:[],async:!1}},4142:{"*":{id:"604",name:"*",chunks:[],async:!1}},4969:{"*":{id:"6613",name:"*",chunks:[],async:!1}},5644:{"*":{id:"6272",name:"*",chunks:[],async:!1}},6671:{"*":{id:"1355",name:"*",chunks:[],async:!1}},6986:{"*":{id:"7130",name:"*",chunks:[],async:!1}},7393:{"*":{id:"4785",name:"*",chunks:[],async:!1}},9615:{"*":{id:"2857",name:"*",chunks:[],async:!1}}},edgeRscModuleMapping:{}},u.__BUILD_MANIFEST={polyfillFiles:["static/chunks/polyfills-42372ed130431b0a.js"],devFiles:[],ampDevFiles:[],lowPriorityFiles:[],rootMainFiles:["static/chunks/webpack-c81e624915b2ea70.js","static/chunks/e8d355e3-9914e85471131ade.js","static/chunks/524-3b39176777d9e519.js","static/chunks/main-app-0022c77dafc7be16.js"],rootMainFilesTree:{},pages:{"/_app":["static/chunks/webpack-c81e624915b2ea70.js","static/chunks/framework-dbaf03ed0eaf1259.js","static/chunks/main-789822056cd1f79e.js","static/chunks/pages/_app-fe624f995ae23665.js"],"/_error":["static/chunks/webpack-c81e624915b2ea70.js","static/chunks/framework-dbaf03ed0eaf1259.js","static/chunks/main-789822056cd1f79e.js","static/chunks/pages/_error-ad68bc602291205c.js"]},ampFirstPages:[]},u.__BUILD_MANIFEST.lowPriorityFiles=["/static/DTeZGmGGn6W-QfwdbqtUt/_buildManifest.js",,"/static/DTeZGmGGn6W-QfwdbqtUt/_ssgManifest.js"],U.__REACT_LOADABLE_MANIFEST=Co,U.__NEXT_FONT_MANIFEST=bo,U.__INTERCEPTION_ROUTE_REWRITE_MANIFEST="[]",(()=>{"use strict";var Q={},Z={};function n(g){var H=Z[g];if(H!==void 0)return H.exports;var v=Z[g]={id:g,loaded:!1,exports:{}},ee=!0;try{Q[g].call(v.exports,v,v.exports,n),ee=!1}finally{ee&&delete Z[g]}return v.loaded=!0,v.exports}n.m=Q,n.amdO={},(()=>{var g=[];n.O=(H,v,ee,K)=>{if(v){K=K||0;for(var q=g.length;q>0&&g[q-1][2]>K;q--)g[q]=g[q-1];g[q]=[v,ee,K];return}for(var ce=1/0,q=0;q<g.length;q++){for(var[v,ee,K]=g[q],de=!0,ue=0;ue<v.length;ue++)(!1&K||ce>=K)&&Object.keys(n.O).every(Ce=>n.O[Ce](v[ue]))?v.splice(ue--,1):(de=!1,K<ce&&(ce=K));if(de){g.splice(q--,1);var pe=ee();pe!==void 0&&(H=pe)}}return H}})(),n.n=g=>{var H=g&&g.__esModule?()=>g.default:()=>g;return n.d(H,{a:H}),H},n.d=(g,H)=>{for(var v in H)n.o(H,v)&&!n.o(g,v)&&Object.defineProperty(g,v,{enumerable:!0,get:H[v]})},n.e=()=>Promise.resolve(),n.g=function(){if(typeof u=="object")return u;try{return this||Function("return this")()}catch{if(typeof window=="object")return window}}(),n.o=(g,H)=>Object.prototype.hasOwnProperty.call(g,H),n.r=g=>{typeof Symbol<"u"&&Symbol.toStringTag&&Object.defineProperty(g,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(g,"__esModule",{value:!0})},n.nmd=g=>(g.paths=[],g.children||(g.children=[]),g),(()=>{var g={149:0};n.O.j=ee=>g[ee]===0;var H=(ee,K)=>{var q,ce,[de,ue,pe]=K,Oe=0;if(de.some(Ie=>g[Ie]!==0)){for(q in ue)n.o(ue,q)&&(n.m[q]=ue[q]);if(pe)var Fe=pe(n)}for(ee&&ee(K);Oe<de.length;Oe++)ce=de[Oe],n.o(g,ce)&&g[ce]&&g[ce][0](),g[ce]=0;return n.O(Fe)},v=U.webpackChunk_N_E=U.webpackChunk_N_E||[];v.forEach(H.bind(null,0)),v.push=H.bind(null,v.push.bind(v))})()})(),(U.webpackChunk_N_E=U.webpackChunk_N_E||[]).push([[499],{137:Js,143:zs,297:Ks,305:Bs,311:Xs,315:Gs,471:Vs,482:qs,555:Ws,773:$s,816:Hs,981:Ys,1012:Ms,1114:Us,1350:Fs,1357:js,1415:Ds,1450:Ps,1669:Ls,1728:vs,1755:Is,2009:Ss,2052:As,2231:Rs,2338:Cs,2354:bs,2452:Os,2500:ws,2555:Ns,2724:Ts,2975:ks,2978:xs,3282:ys,3389:Es,3464:gs,3481:_s,3560:fs,4084:ms,4171:hs,4442:ps,4452:us,4600:ds,4604:ls,4799:cs,4838:rs,4962:is,5108:as,5115:os,5123:ss,5156:ns,5205:ts,5214:es,5275:Zn,5295:Qn,5431:Jn,5467:zn,5582:Kn,5626:Bn,5687:Xn,5697:Gn,5759:Vn,5807:qn,5813:Wn,5931:$n,5951:Hn,5988:Yn,6161:Mn,6233:Un,6244:Fn,6276:jn,6399:Dn,6463:Pn,6466:Ln,6487:vn,6597:In,6753:Sn,6825:An,6899:Rn,6941:Cn,7066:bn,7078:On,7149:wn,7254:Nn,7329:Tn,7671:kn,7724:xn,7762:yn,7992:En,8051:gn,8105:_n,8146:fn,8183:mn,8246:hn,8289:pn,8311:un,8312:dn,8455:ln,8468:cn,8538:rn,8561:an,8637:on,8733:sn,8807:nn,8818:tn,8877:en,8903:Zt,8948:Qt,8952:Jt,9146:zt,9249:Kt,9412:Bt,9441:Xt,9542:Gt,9614:Vt,9756:qt}]),(U.webpackChunk_N_E=U.webpackChunk_N_E||[]).push([[464],{683:Oo,1011:wo,1582:No,1600:To,1605:ko,1826:xo,2627:yo,2892:Eo,4008:go,4215:_o,4236:fo,5371:mo,5579:ho,5878:po,5985:uo,6172:lo,6479:co,6933:ro,9054:io,9056:ao,9068:oo,9182:so,9245:no,9349:to,9502:eo}]),(U.webpackChunk_N_E=U.webpackChunk_N_E||[]).push([[241],{975:Wt,4693:(Q,Z,n)=>{"use strict";n.r(Z),n.d(Z,{ComponentMod:()=>Ct,default:()=>Rt});var g,H={};n.r(H),n.d(H,{POST:()=>Tt,runtime:()=>kt});var v={};n.r(v),n.d(v,{handler:()=>bt,patchFetch:()=>Ot,routeModule:()=>_e,serverHooks:()=>wt,workAsyncStorage:()=>ht,workUnitAsyncStorage:()=>mt});var ee=n(981),K=n(1114),q=n(5626),ce=n(5759),de=n(3464),ue=n(6597),pe=n(5951),Oe=n(3481),Fe=n(2354),Ie=n(8105),ve=n(9412),Ce=n(5687),Xe=n(2052),Ue=n(4962),Be=n(8952),Qe=n(8538),Le=n(2975),Ze=n(816),Ne=n(6233),Me=n(6463),ge=n(6172),a=n(4008),D=n(5878),b=n(9245),N=n(5579),R=function(x){return x.UPDATE_COMPONENT="UPDATE_COMPONENT",x.ADD_FEATURE="ADD_FEATURE",x.FIX_ISSUE="FIX_ISSUE",x.REFACTOR="REFACTOR",x.FULL_REBUILD="FULL_REBUILD",x.UPDATE_STYLE="UPDATE_STYLE",x.ADD_DEPENDENCY="ADD_DEPENDENCY",x}({});function V(x,h){let m=[],E=x.toLowerCase(),j=Ee(x);for(let[X,G]of(console.log("[findComponentFiles] Extracted words:",j),Object.entries(h.files))){let he=X.split("/").pop()?.toLowerCase()||"",z=G.componentInfo?.name.toLowerCase();for(let k of j)if(he.includes(k)||z?.includes(k)){console.log(`[findComponentFiles] Match found: word="${k}" in file="${X}"`),m.push(X);break}}if(m.length===0){for(let X of["header","footer","nav","sidebar","button","card","modal","hero","banner","about","services","features","testimonials","gallery","contact","team","pricing"])if(E.includes(X)){for(let[G,he]of Object.entries(h.files)){let z=G.split("/").pop()?.toLowerCase()||"";if(z.includes(X+".")||z===X)return m.push(G),console.log(`[findComponentFiles] UI element match: element="${X}" in file="${G}"`),m}for(let[G,he]of Object.entries(h.files))if((G.split("/").pop()?.toLowerCase()||"").includes(X))return m.push(G),console.log(`[findComponentFiles] UI element partial match: element="${X}" in file="${G}"`),m}}return m.length>1?(console.log(`[findComponentFiles] Multiple files found (${m.length}), limiting to first match`),[m[0]]):m.length>0?m:[h.entryPoint]}function Ee(x){let h=[];for(let m of x.replace(/\b(the|a|an|in|on|to|from|update|change|modify|edit|fix|make)\b/gi,"").toLowerCase().match(/\b\w+\b/g)||[])m.length>2&&h.push(m);return h}let we=`
## Edit Strategy Examples

### Example 1: Update Header Color
USER: "Make the header background black"

CORRECT APPROACH:
1. Identify Header component location
2. Edit ONLY Header.jsx
3. Change background color class/style

INCORRECT APPROACH:
- Regenerating entire App.jsx
- Creating new Header.jsx from scratch
- Modifying unrelated files

EXPECTED OUTPUT:
<file path="src/components/Header.jsx">
// Only the Header component with updated background
// Preserving all existing functionality
</file>

### Example 2: Add New Page
USER: "Add a videos page"

CORRECT APPROACH:
1. Create Videos.jsx component
2. Update routing in App.jsx or Router component
3. Add navigation link if needed

INCORRECT APPROACH:
- Regenerating entire application
- Recreating all existing pages

EXPECTED OUTPUT:
<file path="src/components/Videos.jsx">
// New Videos component
</file>

<file path="src/App.jsx">
// ONLY the routing update, preserving everything else
</file>

### Example 3: Fix Styling Issue
USER: "Fix the button styling on mobile"

CORRECT APPROACH:
1. Identify which component has the button
2. Update only that component's Tailwind classes
3. Add responsive modifiers (sm:, md:, etc)

INCORRECT APPROACH:
- Regenerating all components
- Creating new CSS files
- Modifying global styles unnecessarily

### Example 4: Add Feature to Component
USER: "Add a search bar to the header"

CORRECT APPROACH:
1. Modify Header.jsx to add search functionality
2. Preserve all existing header content
3. Integrate search seamlessly

INCORRECT APPROACH:
- Creating Header.jsx from scratch
- Losing existing navigation/branding

### Example 5: Add New Component
USER: "Add a newsletter signup to the footer"

CORRECT APPROACH:
1. Create Newsletter.jsx component
2. UPDATE Footer.jsx to import Newsletter
3. Add <Newsletter /> in the appropriate place in Footer

EXPECTED OUTPUT:
<file path="src/components/Newsletter.jsx">
// New Newsletter component
</file>

<file path="src/components/Footer.jsx">
// Updated Footer with Newsletter import and usage
import Newsletter from './Newsletter';
// ... existing code ...
// Add <Newsletter /> in the render
</file>

### Example 6: Add External Library
USER: "Add animations with framer-motion to the hero"

CORRECT APPROACH:
1. Import framer-motion in Hero.jsx
2. Use motion components
3. System will auto-install framer-motion

EXPECTED OUTPUT:
<file path="src/components/Hero.jsx">
import { motion } from 'framer-motion';
// ... rest of Hero with motion animations
</file>

### Example 7: Remove Element
USER: "Remove start deploying button"

CORRECT APPROACH:
1. Search for "start deploying" in all component files
2. Find it in Hero.jsx
3. Edit ONLY Hero.jsx to remove that button

INCORRECT APPROACH:
- Creating a new file
- Editing multiple files
- Redesigning the entire Hero

EXPECTED OUTPUT:
<file path="src/components/Hero.jsx">
// Hero component with "start deploying" button removed
// All other content preserved
</file>

### Example 8: Delete Section
USER: "Delete the testimonials section"

CORRECT APPROACH:
1. Find which file contains testimonials
2. Remove only that section from the file
3. Keep all other content intact

INCORRECT APPROACH:
- Deleting the entire file
- Recreating the page without testimonials

### Example 9: Change a Single Style (CRITICAL EXAMPLE)
USER: "update the hero to bg blue"

CORRECT APPROACH:
1. Identify the Hero component file: 'src/components/Hero.jsx'.
2. Locate the outermost 'div' or container element.
3. Find the existing background color class (e.g., 'bg-gray-900').
4. Replace ONLY that class with 'bg-blue-500'.
5. Return the entire file, completely unchanged except for that single class modification.

**Original File Content (BEFORE):**
<file path="src/components/Hero.jsx">
import React from 'react';

return function Hero() {
  return (
    <div className="w-full bg-gray-900 text-white py-20 px-4">
      <h1 className="text-5xl font-bold">Welcome to the App</h1>
      <p className="mt-4 text-lg">This is the original hero section.</p>
      <button className="mt-6 px-6 py-3 bg-blue-600 hover:bg-blue-700 rounded-lg">
        Get Started
      </button>
    </div>
  );
}
</file>

**Expected Output (AFTER):**
<file path="src/components/Hero.jsx">
import React from 'react';

return function Hero() {
  return (
    <div className="w-full bg-blue-500 text-white py-20 px-4">
      <h1 className="text-5xl font-bold">Welcome to the App</h1>
      <p className="mt-4 text-lg">This is the original hero section.</p>
      <button className="mt-6 px-6 py-3 bg-blue-600 hover:bg-blue-700 rounded-lg">
        Get Started
      </button>
    </div>
  );
}
</file>

NOTICE: Everything remains EXACTLY the same except 'bg-gray-900' \u2192 'bg-blue-500'. 
- The button still has bg-blue-600 (unchanged)
- All text, structure, imports are identical
- No reformatting, no "improvements", no cleanup

## Key Principles

1. **Minimal Changes**: Only modify what's necessary
2. **Preserve Functionality**: Keep all existing features
3. **Respect Structure**: Follow existing patterns
4. **Target Precision**: Edit specific files, not everything
5. **Context Awareness**: Use imports/exports to understand relationships

## File Identification Patterns

- "header" \u2192 src/components/Header.jsx
- "navigation" \u2192 src/components/Nav.jsx or Header.jsx
- "footer" \u2192 src/components/Footer.jsx
- "home page" \u2192 src/App.jsx or src/pages/Home.jsx
- "styling" \u2192 Component files (Tailwind) or index.css
- "routing" \u2192 App.jsx or Router component
- "layout" \u2192 Layout components or App.jsx

## Edit Intent Classification

UPDATE_COMPONENT: Modify existing component
- Keywords: update, change, modify, edit, fix
- Action: Edit single file

ADD_FEATURE: Add new functionality
- Keywords: add, create, implement, build
- Action: Create new files + minimal edits

FIX_ISSUE: Resolve problems
- Keywords: fix, resolve, debug, repair
- Action: Targeted fixes

UPDATE_STYLE: Change appearance
- Keywords: style, color, theme, design
- Action: Update Tailwind classes

REFACTOR: Improve code quality
- Keywords: refactor, clean, optimize
- Action: Restructure without changing behavior
`;function le(x,h){let m=function(l,W){let M=l.toLowerCase();for(let oe of[{patterns:[/update\s+(the\s+)?(\w+)\s+(component|section|page)/i,/change\s+(the\s+)?(\w+)/i,/modify\s+(the\s+)?(\w+)/i,/edit\s+(the\s+)?(\w+)/i,/fix\s+(the\s+)?(\w+)\s+(styling|style|css|layout)/i,/remove\s+.*\s+(button|link|text|element|section)/i,/delete\s+.*\s+(button|link|text|element|section)/i,/hide\s+.*\s+(button|link|text|element|section)/i],type:R.UPDATE_COMPONENT,fileResolver:(L,A)=>function(S,f){let d=[];S.toLowerCase(),console.log("[findComponentByContent] Searching for content in prompt:",S);let C=(S.match(/["']([^"']+)["']/g)||[]).map(y=>y.replace(/["']/g,"")),p=S.match(/(?:remove|delete|hide)\s+(?:the\s+)?(.+?)(?:\s+button|\s+link|\s+text|\s+element|\s+section|$)/i);if(p&&C.push(p[1].trim()),console.log("[findComponentByContent] Search terms:",C),C.length>0)for(let[y,P]of Object.entries(f.files)){if(!y.includes(".jsx")&&!y.includes(".tsx"))continue;let J=P.content.toLowerCase();for(let me of C)if(J.includes(me.toLowerCase())){console.log(`[findComponentByContent] Found "${me}" in ${y}`),d.push(y);break}}return d.length===0?(console.log("[findComponentByContent] No files found by content, falling back to component name search"),V(S,f)):[d[0]]}(L,A)},{patterns:[/add\s+(a\s+)?new\s+(\w+)\s+(page|section|feature|component)/i,/create\s+(a\s+)?(\w+)\s+(page|section|feature|component)/i,/implement\s+(a\s+)?(\w+)\s+(page|section|feature)/i,/build\s+(a\s+)?(\w+)\s+(page|section|feature)/i,/add\s+(\w+)\s+to\s+(?:the\s+)?(\w+)/i,/add\s+(?:a\s+)?(\w+)\s+(?:component|section)/i,/include\s+(?:a\s+)?(\w+)/i],type:R.ADD_FEATURE,fileResolver:(L,A)=>function(S,f){let d=[],C=S.toLowerCase();if(C.includes("page")){for(let[p,y]of Object.entries(f.files))(y.content.includes("Route")||y.content.includes("createBrowserRouter")||p.includes("router")||p.includes("routes"))&&d.push(p);f.entryPoint&&d.push(f.entryPoint)}if(C.includes("component")||C.includes("section")||C.includes("add")||C.includes("create")){let p=S.match(/(?:in|to|on|inside)\s+(?:the\s+)?(\w+)/i);if(p){let y=p[1],P=V(y,f);d.push(...P),console.log(`[findFeatureInsertionPoints] Adding to ${y}, parent files:`,P)}else{for(let y of Ee(S)){let P=V(y,f);P.length>0&&P[0]!==f.entryPoint&&d.push(...P)}d.length===0&&d.push(f.entryPoint)}}return[...new Set(d)]}(L,A)},{patterns:[/fix\s+(the\s+)?(\w+|\w+\s+\w+)(?!\s+styling|\s+style)/i,/resolve\s+(the\s+)?error/i,/debug\s+(the\s+)?(\w+)/i,/repair\s+(the\s+)?(\w+)/i],type:R.FIX_ISSUE,fileResolver:(L,A)=>function(S,f){let d=[];if(S.match(/error|bug|issue|problem|broken|not working/i)){let p=Object.entries(f.files).sort(([,y],[,P])=>P.lastModified-y.lastModified).slice(0,5);d.push(...p.map(([y])=>y))}let C=V(S,f);return d.push(...C),[...new Set(d)]}(L,A)},{patterns:[/change\s+(the\s+)?(color|theme|style|styling|css)/i,/update\s+(the\s+)?(color|theme|style|styling|css)/i,/make\s+it\s+(dark|light|blue|red|green)/i,/style\s+(the\s+)?(\w+)/i],type:R.UPDATE_STYLE,fileResolver:(L,A)=>function(S,f){let d=[];d.push(...f.styleFiles);let C=Object.keys(f.files).find(p=>p.includes("tailwind.config"));return C&&d.push(C),d.push(...V(S,f)),d}(L,A)},{patterns:[/refactor\s+(the\s+)?(\w+)/i,/clean\s+up\s+(the\s+)?code/i,/reorganize\s+(the\s+)?(\w+)/i,/optimize\s+(the\s+)?(\w+)/i],type:R.REFACTOR,fileResolver:(L,A)=>V(L,A)},{patterns:[/start\s+over/i,/recreate\s+everything/i,/rebuild\s+(the\s+)?app/i,/new\s+app/i,/from\s+scratch/i],type:R.FULL_REBUILD,fileResolver:(L,A)=>[A.entryPoint]},{patterns:[/install\s+(\w+)/i,/add\s+(\w+)\s+(package|library|dependency)/i,/use\s+(\w+)\s+(library|framework)/i],type:R.ADD_DEPENDENCY,fileResolver:(L,A)=>function(S){let f=[];for(let d of Object.keys(S.files))(d.endsWith("package.json")||d.endsWith("vite.config.js")||d.endsWith("tsconfig.json"))&&f.push(d);return f}(A)}])for(let L of oe.patterns)if(L.test(M)){let A=oe.fileResolver(l,W),S=function(f,d){return Object.keys(d.files).filter(C=>!f.includes(C))}(A,W);return{type:oe.type,targetFiles:A,confidence:function(f,d,C){let p=.5;for(let y of(C.length>0&&C[0]!==""&&(p+=.2),f.split(" ").length>5&&(p+=.1),d.patterns))if(y.test(f)){p+=.2;break}return Math.min(p,1)}(l,oe,A),description:function(f,d,C){let p=C.map(y=>y.split("/").pop()).join(", ");switch(f){case R.UPDATE_COMPONENT:return`Updating component(s): ${p}`;case R.ADD_FEATURE:return`Adding new feature to: ${p}`;case R.FIX_ISSUE:return`Fixing issue in: ${p}`;case R.UPDATE_STYLE:return`Updating styles in: ${p}`;case R.REFACTOR:return`Refactoring: ${p}`;case R.FULL_REBUILD:return"Rebuilding entire application";case R.ADD_DEPENDENCY:return"Adding new dependency";default:return`Editing: ${p}`}}(oe.type,0,A),suggestedContext:S}}return{type:R.UPDATE_COMPONENT,targetFiles:[W.entryPoint],confidence:.3,description:"General update to application",suggestedContext:[]}}(x,h),E=m.targetFiles,j=Object.keys(h.files),X=j.filter(l=>!E.includes(l)),G=[],he=j.find(l=>l.endsWith("App.jsx")||l.endsWith("App.tsx"));he&&!E.includes(he)&&G.push(he);let z=j.find(l=>l.endsWith("tailwind.config.js")||l.endsWith("tailwind.config.ts"));z&&!E.includes(z)&&G.push(z);let k=j.find(l=>l.endsWith("index.css")||l.endsWith("globals.css"));k&&!E.includes(k)&&G.push(k);let $=j.find(l=>l.endsWith("package.json"));$&&!E.includes($)&&G.push($);let ye=function(l,W,M,oe,L){var A;let S=[];return W.type!==R.FULL_REBUILD&&S.push(we),S.push(`## Edit Intent
Type: ${W.type}
Description: ${W.description}
Confidence: ${(100*W.confidence).toFixed(0)}%

User Request: "${l}"`),S.push(function(f){let d=Object.entries(f.files).map(([p])=>p.replace("/home/user/app/","")).filter(p=>!p.includes("node_modules")).sort(),C=Object.entries(f.files).filter(([,p])=>p.type==="component"||p.type==="page").map(([p,y])=>({path:p.replace("/home/user/app/",""),name:y.componentInfo?.name||p.split("/").pop(),type:y.type}));return`## \u{1F6A8} EXISTING PROJECT FILES - DO NOT CREATE NEW FILES WITH SIMILAR NAMES \u{1F6A8}

### ALL PROJECT FILES (${d.length} files)
\`\`\`
${d.join(`
`)}
\`\`\`

### Component Files (USE THESE EXACT NAMES)
${C.map(p=>`- ${p.name} \u2192 ${p.path} (${p.type})`).join(`
`)}

### CRITICAL: Component Relationships
**ALWAYS CHECK App.jsx FIRST** to understand what components exist and how they're imported!

Common component overlaps to watch for:
- "nav" or "navigation" \u2192 Often INSIDE Header.jsx, not a separate file
- "menu" \u2192 Usually part of Header/Nav, not separate
- "logo" \u2192 Typically in Header, not standalone

When user says "nav" or "navigation":
1. First check if Header.jsx exists
2. Look inside Header.jsx for navigation elements
3. Only create Nav.jsx if navigation doesn't exist anywhere

Entry Point: ${f.entryPoint}

### Routes
${f.routes.map(p=>`- ${p.path} \u2192 ${p.component.split("/").pop()}`).join(`
`)||"No routes detected"}`}(L)),S.push((A=Object.keys(L.files).map(f=>f.replace("/home/user/app/","")).join(`
`),`
## Current Project Structure

${A}

## Component Naming Patterns
Based on your file structure, here are the patterns to follow:

1. Component files are in: src/components/
2. Page components might be in: src/pages/ or src/components/
3. Utility functions are in: src/utils/ or src/lib/
4. Styles use Tailwind classes inline
5. Main app entry is: src/App.jsx

When the user mentions a component by name, look for:
- Exact matches first (Header \u2192 Header.jsx)
- Partial matches (nav \u2192 Navigation.jsx, NavBar.jsx)
- Semantic matches (top bar \u2192 Header.jsx)
`)),M.length>0&&S.push(`## Files to Edit
${M.map(f=>{let d=L.files[f];return`- ${f}${d?.componentInfo?` (${d.componentInfo.name} component)`:""}`}).join(`
`)}`),oe.length>0&&S.push(`## Context Files (for reference only)
${oe.map(f=>{let d=L.files[f];return`- ${f}${d?.componentInfo?` (${d.componentInfo.name} component)`:""}`}).join(`
`)}`),S.push(function(f){let d={[R.UPDATE_COMPONENT]:`## SURGICAL EDIT INSTRUCTIONS
- You MUST preserve 99% of the original code
- ONLY edit the specific component(s) mentioned
- Make ONLY the minimal change requested
- DO NOT rewrite or refactor unless explicitly asked
- DO NOT remove any existing code unless explicitly asked
- DO NOT change formatting or structure
- Preserve all imports and exports
- Maintain the existing code style
- Return the COMPLETE file with the surgical change applied
- Think of yourself as a surgeon making a precise incision, not an artist repainting`,[R.ADD_FEATURE]:`## Instructions
- Create new components in appropriate directories
- IMPORTANT: Update parent components to import and use the new component
- Update routing if adding new pages
- Follow existing patterns and conventions
- Add necessary styles to match existing design
- Example workflow:
  1. Create NewComponent.jsx
  2. Import it in the parent: import NewComponent from './NewComponent'
  3. Use it in the parent's render: <NewComponent />`,[R.FIX_ISSUE]:`## Instructions
- Identify and fix the specific issue
- Test the fix doesn't break other functionality
- Preserve existing behavior except for the bug
- Add error handling if needed`,[R.UPDATE_STYLE]:`## SURGICAL STYLE EDIT INSTRUCTIONS
- Change ONLY the specific style/class mentioned
- If user says "change background to blue", change ONLY the background class
- DO NOT touch any other styles, classes, or attributes
- DO NOT refactor or "improve" the styling
- DO NOT change the component structure
- Preserve ALL other classes and styles exactly as they are
- Return the COMPLETE file with only the specific style change`,[R.REFACTOR]:`## Instructions
- Improve code quality without changing functionality
- Follow project conventions
- Maintain all existing features
- Improve readability and maintainability`,[R.FULL_REBUILD]:`## Instructions
- You may rebuild the entire application
- Keep the same core functionality
- Improve upon the existing design
- Use modern best practices`,[R.ADD_DEPENDENCY]:`## Instructions
- Update package.json with new dependency
- Add necessary import statements
- Configure the dependency if needed
- Update any build configuration`};return d[f]||d[R.UPDATE_COMPONENT]}(W.type)),(W.type===R.UPDATE_COMPONENT||W.type===R.ADD_FEATURE)&&S.push(function(f,d){let C=["## Component Relationships"];for(let p of f){let y=d.files[p];if(!y?.componentInfo)continue;let P=y.componentInfo.name,J=d.componentTree[P];J&&(C.push(`
### ${P}`),J.imports.length>0&&C.push(`Imports: ${J.imports.join(", ")}`),J.importedBy.length>0&&C.push(`Used by: ${J.importedBy.join(", ")}`),y.componentInfo.childComponents?.length&&C.push(`Renders: ${y.componentInfo.childComponents.join(", ")}`))}return C.join(`
`)}(M,L)),S.join(`

`)}(x,m,E,X=[...G,...X.filter(l=>!G.includes(l))],h);return{primaryFiles:E,contextFiles:X,systemPrompt:ye,editIntent:m}}async function fe(x,h){let m={};for(let E of x){let j=h.files[E];j&&(m[E]=j.content)}return m}function Ye(x){let h=x.split(".").pop()||"";return{js:"javascript",jsx:"javascript",ts:"typescript",tsx:"typescript",css:"css",json:"json"}[h]||h}var ct=n(5492);let kt="edge",lt=(0,ge.c)({apiKey:process.env.GROQ_API_KEY}),dt=(0,a.n)({apiKey:process.env.ANTHROPIC_API_KEY,baseURL:process.env.ANTHROPIC_BASE_URL||"https://api.anthropic.com/v1"}),ut=(0,b.s)({apiKey:process.env.GEMINI_API_KEY}),pt=(0,D.r)({apiKey:process.env.OPENAI_API_KEY});async function Tt(x){try{let{prompt:h,model:m="openai/gpt-oss-20b",context:E,isEdit:j=!1}=await x.json();console.log("[generate-ai-code-stream] Received request:"),console.log("[generate-ai-code-stream] - prompt:",h),console.log("[generate-ai-code-stream] - isEdit:",j),console.log("[generate-ai-code-stream] - context.sandboxId:",E?.sandboxId),console.log("[generate-ai-code-stream] - context.currentFiles:",E?.currentFiles?Object.keys(E.currentFiles):"none"),console.log("[generate-ai-code-stream] - currentFiles count:",E?.currentFiles?Object.keys(E.currentFiles).length:0),n.g.conversationState||(n.g.conversationState={conversationId:`conv-${Date.now()}`,startedAt:Date.now(),lastUpdated:Date.now(),context:{messages:[],edits:[],projectEvolution:{majorChanges:[]},userPreferences:{}}});let X={id:`msg-${Date.now()}`,role:"user",content:h,timestamp:Date.now(),metadata:{sandboxId:E?.sandboxId}};if(n.g.conversationState.context.messages.push(X),n.g.conversationState.context.messages.length>20&&(n.g.conversationState.context.messages=n.g.conversationState.context.messages.slice(-15),console.log("[generate-ai-code-stream] Trimmed conversation history to prevent context overflow")),n.g.conversationState.context.edits.length>10&&(n.g.conversationState.context.edits=n.g.conversationState.context.edits.slice(-8)),E?.currentFiles&&Object.keys(E.currentFiles).length>0){let $=Object.entries(E.currentFiles)[0];console.log("[generate-ai-code-stream] - sample file:",$[0]),console.log("[generate-ai-code-stream] - sample content preview:",typeof $[1]=="string"?$[1].substring(0,100)+"...":"not a string")}if(!h)return Me.Rp.json({success:!1,error:"Prompt is required"},{status:400});let G=new TextEncoder,he=new TransformStream,z=he.writable.getWriter(),k=async $=>{let ye=`data: ${JSON.stringify($)}

`;await z.write(G.encode(ye))};return(async()=>{try{let $,ye;await k({type:"status",message:"Initializing AI..."});let l=null,W="";if(j){console.log("[generate-ai-code-stream] Edit mode detected - starting agentic search workflow"),console.log("[generate-ai-code-stream] Has fileCache:",!!u.sandboxState?.fileCache),console.log("[generate-ai-code-stream] Has manifest:",!!u.sandboxState?.fileCache?.manifest);let t=u.sandboxState?.fileCache?.manifest;if(t){await k({type:"status",message:"\u{1F50D} Creating search plan..."});let _=u.sandboxState?.fileCache?.files||{};console.log("[generate-ai-code-stream] Files available for search:",Object.keys(_).length);try{let T=await fetch(`${process.env.NEXT_PUBLIC_APP_URL||"http://localhost:3000"}/api/analyze-edit-intent`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({prompt:h,manifest:t,model:m})});if(T.ok){let{searchPlan:c}=await T.json();console.log("[generate-ai-code-stream] Search plan received:",c),await k({type:"status",message:`\u{1F50E} Searching for: "${c.searchTerms.join('", "')}"`});let i=function(r,s){let w=Date.now(),o=[],I=0,O=!1,{searchTerms:F=[],regexPatterns:tt=[],fileTypesToSearch:re=[".jsx",".tsx",".js",".ts"],fallbackSearch:Ae}=r,_t=(nt,Ke)=>{let qe=[];for(let[gt,St]of Object.entries(s)){if(!re.some(Te=>gt.endsWith(Te)))continue;I++;let Ve=St.split(`
`);for(let Te=0;Te<Ve.length;Te++){let ze,st,Se=Ve[Te],Je=!1;for(let be of nt)if(Se.toLowerCase().includes(be.toLowerCase())){Je=!0,ze=be;break}if(!Je&&Ke)for(let be of Ke)try{if(RegExp(be,"i").test(Se)){Je=!0,st=be;break}}catch{console.warn(`[file-search] Invalid regex pattern: ${be}`)}if(Je){let be=Ve.slice(Math.max(0,Te-3),Te),Et=Ve.slice(Te+1,Math.min(Ve.length,Te+4)),ot="medium";ze&&Se.includes(ze)||Se.includes("function")||Se.includes("export")||Se.includes("return")?ot="high":st&&(ot="medium"),qe.push({filePath:gt,lineNumber:Te+1,lineContent:Se.trim(),matchedTerm:ze,matchedPattern:st,contextBefore:be,contextAfter:Et,confidence:ot})}}}return qe};o.push(..._t(F,tt)),o.length===0&&Ae&&(console.log("[file-search] No results from primary search, trying fallback..."),O=!0,o.push(..._t(Ae.terms,Ae.patterns)));let At=Date.now()-w;return o.sort((nt,Ke)=>{let qe={high:3,medium:2,low:1};return qe[Ke.confidence]-qe[nt.confidence]}),{success:o.length>0,results:o,filesSearched:I,executionTime:At,usedFallback:O,error:o.length===0?"No matches found for search terms":void 0}}(c,Object.fromEntries(Object.entries(_).map(([r,s])=>[r.startsWith("/")?r:`/home/user/app/${r}`,s.content])));if(console.log("[generate-ai-code-stream] Search execution:",{success:i.success,resultsCount:i.results.length,filesSearched:i.filesSearched,time:i.executionTime+"ms"}),i.success&&i.results.length>0){let r=function(s,w){if(s.length===0)return null;if(w==="UPDATE_STYLE"){let I=s.find(O=>O.filePath.endsWith(".jsx")||O.filePath.endsWith(".tsx"));if(I)return{filePath:I.filePath,lineNumber:I.lineNumber,reason:"Found component with style to update"}}if(w==="REMOVE_ELEMENT"){let I=s.find(O=>O.lineContent.includes("return")||O.lineContent.includes("<"));if(I)return{filePath:I.filePath,lineNumber:I.lineNumber,reason:"Found element to remove in render output"}}let o=s[0];return{filePath:o.filePath,lineNumber:o.lineNumber,reason:`Highest confidence match (${o.confidence})`}}(i.results,c.editType);if(r){await k({type:"status",message:`\u2705 Found code in ${r.filePath.split("/").pop()} at line ${r.lineNumber}`}),console.log("[generate-ai-code-stream] Target selected:",r);let s=r.filePath.replace("/home/user/app/","");_[s]?.content,W=`
${function(w){if(w.length===0)return"No search results found.";let o=[];o.push(`\u{1F50D} SEARCH RESULTS - EXACT LOCATIONS FOUND:
`);let I=new Map;for(let F of w)I.has(F.filePath)||I.set(F.filePath,[]),I.get(F.filePath).push(F);for(let[F,tt]of I)for(let re of(o.push(`
\u{1F4C4} FILE: ${F}`),tt))if(o.push(`
  \u{1F4CD} Line ${re.lineNumber} (${re.confidence} confidence)`),re.matchedTerm?o.push(`     Matched: "${re.matchedTerm}"`):re.matchedPattern&&o.push(`     Pattern: ${re.matchedPattern}`),o.push(`     Code: ${re.lineContent}`),re.contextBefore.length>0||re.contextAfter.length>0){for(let Ae of(o.push("     Context:"),re.contextBefore))o.push(`       ${Ae}`);for(let Ae of(o.push(`     \u2192 ${re.lineContent}`),re.contextAfter))o.push(`       ${Ae}`)}o.push(`

\u{1F3AF} RECOMMENDED ACTION:`);let O=w[0];return o.push(`Edit ${O.filePath} at line ${O.lineNumber}`),o.join(`
`)}(i.results)}

SURGICAL EDIT INSTRUCTIONS:
You have been given the EXACT location of the code to edit.
- File: ${r.filePath}
- Line: ${r.lineNumber}
- Reason: ${r.reason}

Make ONLY the change requested by the user. Do not modify any other code.
User request: "${h}"`,l={primaryFiles:[r.filePath],contextFiles:[],systemPrompt:W,editIntent:{type:c.editType,description:c.reasoning,targetFiles:[r.filePath],confidence:.95,searchTerms:c.searchTerms}},console.log("[generate-ai-code-stream] Surgical edit context created")}}else console.warn("[generate-ai-code-stream] Search found no results, falling back to broader context"),await k({type:"status",message:"\u26A0\uFE0F Could not find exact match, using broader search..."})}else console.error("[generate-ai-code-stream] Failed to get search plan")}catch(T){console.error("[generate-ai-code-stream] Error in agentic search workflow:",T),await k({type:"status",message:"\u26A0\uFE0F Search workflow error, falling back to keyword method..."}),t&&(l=le(h,t))}}else console.warn("[generate-ai-code-stream] AI intent analysis failed, falling back to keyword method"),t?l=le(h,t):(console.log("[generate-ai-code-stream] No manifest available for fallback"),await k({type:"status",message:"\u26A0\uFE0F No file manifest available, will use broad context"}));if(l)W=l.systemPrompt,await k({type:"status",message:`Identified edit type: ${l.editIntent?.description||"Code modification"}`});else if(!t)if(console.log("[generate-ai-code-stream] WARNING: No manifest available for edit mode!"),n.g.activeSandbox){await k({type:"status",message:"Fetching current files from sandbox..."});try{let _=await fetch(`${process.env.NEXT_PUBLIC_APP_URL||"http://localhost:3000"}/api/get-sandbox-files`,{method:"GET",headers:{"Content-Type":"application/json"}});if(_.ok){let T=await _.json();if(T.success&&T.manifest){console.log("[generate-ai-code-stream] Successfully fetched manifest from sandbox");let c=T.manifest;try{let i=await fetch(`${process.env.NEXT_PUBLIC_APP_URL||"http://localhost:3000"}/api/analyze-edit-intent`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({prompt:h,manifest:c,model:m})});if(i.ok){let{searchPlan:r}=await i.json();console.log("[generate-ai-code-stream] Search plan received (after fetch):",r);let s=[];if(!r||r.searchTerms.length===0){console.warn("[generate-ai-code-stream] No target files after fetch, searching for relevant files");let o=h.toLowerCase(),I=Object.keys(c.files);o.includes("hero")?s=I.filter(O=>O.toLowerCase().includes("hero")):o.includes("header")?s=I.filter(O=>O.toLowerCase().includes("header")):o.includes("footer")?s=I.filter(O=>O.toLowerCase().includes("footer")):o.includes("nav")?s=I.filter(O=>O.toLowerCase().includes("nav")):o.includes("button")&&(s=I.filter(O=>O.toLowerCase().includes("button"))),s.length>0&&console.log("[generate-ai-code-stream] Found target files by keyword search after fetch:",s)}let w=Object.keys(c.files).filter(o=>!s.includes(o));W=(l={primaryFiles:s,contextFiles:w,systemPrompt:`
You are an expert senior software engineer performing a surgical, context-aware code modification. Your primary directive is **precision and preservation**.

Think of yourself as a surgeon making a precise incision, not a construction worker demolishing a wall.

## Search-Based Edit
Search Terms: ${r?.searchTerms?.join(", ")||"keyword-based"}
Edit Type: ${r?.editType||"UPDATE_COMPONENT"}
Reasoning: ${r?.reasoning||"Modifying based on user request"}

Files to Edit: ${s.join(", ")||"To be determined"}
User Request: "${h}"

## Your Mandatory Thought Process (Execute Internally):
Before writing ANY code, you MUST follow these steps:

1. **Understand Intent:**
   - What is the user's core goal? (adding feature, fixing bug, changing style?)
   - Does the conversation history provide extra clues?

2. **Locate the Code:**
   - First examine the Primary Files provided
   - Check the "ALL PROJECT FILES" list to find the EXACT file name
   - "nav" might be Navigation.tsx, NavBar.tsx, Nav.tsx, or Header.tsx
   - DO NOT create a new file if a similar one exists!

3. **Plan the Changes (Mental Diff):**
   - What is the *minimal* set of changes required?
   - Which exact lines need to be added, modified, or deleted?
   - Will this require new packages?

4. **Verify Preservation:**
   - What existing code, props, state, and logic must NOT be touched?
   - How can I make my change without disrupting surrounding code?

5. **Construct the Final Code:**
   - Only after completing steps above, generate the final code
   - Provide the ENTIRE file content with modifications integrated

## Critical Rules & Constraints:

**PRESERVATION IS KEY:** You MUST NOT rewrite entire components or files. Integrate your changes into the existing code. Preserve all existing logic, props, state, and comments not directly related to the user's request.

**MINIMALISM:** Only output files you have actually changed. If a file doesn't need modification, don't include it.

**COMPLETENESS:** Each file must be COMPLETE from first line to last:
- NEVER TRUNCATE - Include EVERY line
- NO ellipsis (...) to skip content
- ALL imports, functions, JSX, and closing tags must be present
- The file MUST be runnable

**SURGICAL PRECISION:**
- Change ONLY what's explicitly requested
- If user says "change background to green", change ONLY the background class
- 99% of the original code should remain untouched
- NO refactoring, reformatting, or "improvements" unless requested

**NO CONVERSATION:** Your output must contain ONLY the code. No explanations or apologies.

## EXAMPLES:

### CORRECT APPROACH for "change hero background to blue":
<thinking>
I need to change the background color of the Hero component. Looking at the file, I see the main div has 'bg-gray-900'. I will change ONLY this to 'bg-blue-500' and leave everything else exactly as is.
</thinking>

Then return the EXACT same file with only 'bg-gray-900' changed to 'bg-blue-500'.

### WRONG APPROACH (DO NOT DO THIS):
- Rewriting the Hero component from scratch
- Changing the structure or reorganizing imports
- Adding or removing unrelated code
- Reformatting or "cleaning up" the code

Remember: You are a SURGEON making a precise incision, not an artist repainting the canvas!`,editIntent:{type:r?.editType||"UPDATE_COMPONENT",targetFiles:s,confidence:r?.85:.6,description:r?.reasoning||"Keyword-based file selection",suggestedContext:[]}}).systemPrompt,await k({type:"status",message:`Identified edit type: ${l.editIntent.description}`})}}catch(i){console.error("[generate-ai-code-stream] Error analyzing intent after fetch:",i)}}else console.error("[generate-ai-code-stream] Failed to get manifest from sandbox files")}else console.error("[generate-ai-code-stream] Failed to fetch sandbox files:",_.status)}catch(_){console.error("[generate-ai-code-stream] Error fetching sandbox files:",_),await k({type:"warning",message:"Could not analyze existing files for targeted edits. Proceeding with general edit mode."})}}else console.log("[generate-ai-code-stream] No active sandbox to fetch files from"),await k({type:"warning",message:"No existing files found. Consider generating initial code first."})}let M="";if(n.g.conversationState&&n.g.conversationState.context.messages.length>1){console.log("[generate-ai-code-stream] Building conversation context"),console.log("[generate-ai-code-stream] Total messages:",n.g.conversationState.context.messages.length),console.log("[generate-ai-code-stream] Total edits:",n.g.conversationState.context.edits.length),M=`

## Conversation History (Recent)
`;let t=n.g.conversationState.context.edits.slice(-3);t.length>0&&(console.log("[generate-ai-code-stream] Including",t.length,"recent edits in context"),M+=`
### Recent Edits:
`,t.forEach(r=>{M+=`- "${r.userRequest}" \u2192 ${r.editType} (${r.targetFiles.map(s=>s.split("/").pop()).join(", ")})
`}));let _=n.g.conversationState.context.messages.slice(-5),T=[];if(_.forEach(r=>{r.metadata?.editedFiles&&T.push(...r.metadata.editedFiles)}),T.length>0){let r=[...new Set(T)];M+=`
### \u{1F6A8} RECENTLY CREATED/EDITED FILES (DO NOT RECREATE THESE):
`,r.forEach(s=>{M+=`- ${s}
`}),M+=`
If the user mentions any of these components, UPDATE the existing file!
`}_.length>2&&(M+=`
### Recent Messages:
`,_.slice(0,-1).forEach(r=>{if(r.role==="user"){let s=r.content.length>100?r.content.substring(0,100)+"...":r.content;M+=`- "${s}"
`}}));let c=n.g.conversationState.context.projectEvolution.majorChanges.slice(-2);c.length>0&&(M+=`
### Recent Changes:
`,c.forEach(r=>{M+=`- ${r.description}
`}));let i=function(r){let s=r.filter(O=>O.role==="user"),w=[],o=0,I=0;return s.forEach(O=>{let F=O.content.toLowerCase();F.match(/\b(update|change|fix|modify|edit|remove|delete)\s+(\w+\s+)?(\w+)\b/)&&o++,F.match(/\b(rebuild|recreate|redesign|overhaul|refactor)\b/)&&I++,F.includes("hero")&&w.push("hero section edits"),F.includes("header")&&w.push("header modifications"),(F.includes("color")||F.includes("style"))&&w.push("styling changes"),F.includes("button")&&w.push("button updates"),F.includes("animation")&&w.push("animation requests")}),{commonPatterns:[...new Set(w)].slice(0,3),preferredEditStyle:o>I?"targeted":"comprehensive"}}(n.g.conversationState.context.messages);i.commonPatterns.length>0&&(M+=`
### User Preferences:
- Edit style: ${i.preferredEditStyle}
`),M.length>2e3&&(M=M.substring(0,2e3)+`
[Context truncated to prevent length errors]`)}let oe=`You are an expert React developer with perfect memory of the conversation. You maintain context across messages and remember scraped websites, generated components, and applied code. Generate clean, modern React code for Vite applications.
${M}

\u{1F6A8} CRITICAL RULES - YOUR MOST IMPORTANT INSTRUCTIONS:
1. **DO EXACTLY WHAT IS ASKED - NOTHING MORE, NOTHING LESS**
   - Don't add features not requested
   - Don't fix unrelated issues
   - Don't improve things not mentioned
2. **CHECK App.jsx FIRST** - ALWAYS see what components exist before creating new ones
3. **NAVIGATION LIVES IN Header.jsx** - Don't create Nav.jsx if Header exists with nav
4. **USE STANDARD TAILWIND CLASSES ONLY**:
   - \u2705 CORRECT: bg-white, text-black, bg-blue-500, bg-gray-100, text-gray-900
   - \u274C WRONG: bg-background, text-foreground, bg-primary, bg-muted, text-secondary
   - Use ONLY classes from the official Tailwind CSS documentation
5. **FILE COUNT LIMITS**:
   - Simple style/text change = 1 file ONLY
   - New component = 2 files MAX (component + parent)
   - If >3 files, YOU'RE DOING TOO MUCH

COMPONENT RELATIONSHIPS (CHECK THESE FIRST):
- Navigation usually lives INSIDE Header.jsx, not separate Nav.jsx
- Logo is typically in Header, not standalone
- Footer often contains nav links already
- Menu/Hamburger is part of Header, not separate

PACKAGE USAGE RULES:
- DO NOT use react-router-dom unless user explicitly asks for routing
- For simple nav links in a single-page app, use scroll-to-section or href="#"
- Only add routing if building a multi-page application
- Common packages are auto-installed from your imports

WEBSITE CLONING REQUIREMENTS:
When recreating/cloning a website, you MUST include:
1. **Header with Navigation** - Usually Header.jsx containing nav
2. **Hero Section** - The main landing area (Hero.jsx)
3. **Main Content Sections** - Features, Services, About, etc.
4. **Footer** - Contact info, links, copyright (Footer.jsx)
5. **App.jsx** - Main app component that imports and uses all components

${j?`CRITICAL: THIS IS AN EDIT TO AN EXISTING APPLICATION

YOU MUST FOLLOW THESE EDIT RULES:
0. NEVER create tailwind.config.js, vite.config.js, package.json, or any other config files - they already exist!
1. DO NOT regenerate the entire application
2. DO NOT create files that already exist (like App.jsx, index.css, tailwind.config.js)
3. ONLY edit the EXACT files needed for the requested change - NO MORE, NO LESS
4. If the user says "update the header", ONLY edit the Header component - DO NOT touch Footer, Hero, or any other components
5. If the user says "change the color", ONLY edit the relevant style or component file - DO NOT "improve" other parts
6. If you're unsure which file to edit, choose the SINGLE most specific one related to the request
7. IMPORTANT: When adding new components or libraries:
   - Create the new component file
   - UPDATE ONLY the parent component that will use it
   - Example: Adding a Newsletter component means:
     * Create Newsletter.jsx
     * Update ONLY the file that will use it (e.g., Footer.jsx OR App.jsx) - NOT both
8. When adding npm packages:
   - Import them ONLY in the files where they're actually used
   - The system will auto-install missing packages

CRITICAL FILE MODIFICATION RULES - VIOLATION = FAILURE:
- **NEVER TRUNCATE FILES** - Always return COMPLETE files with ALL content
- **NO ELLIPSIS (...)** - Include every single line of code, no skipping
- Files MUST be complete and runnable - include ALL imports, functions, JSX, and closing tags
- Count the files you're about to generate
- If the user asked to change ONE thing, you should generate ONE file (or at most two if adding a new component)
- DO NOT "fix" or "improve" files that weren't mentioned in the request
- DO NOT update multiple components when only one was requested
- DO NOT add features the user didn't ask for
- RESIST the urge to be "helpful" by updating related files

CRITICAL: DO NOT REDESIGN OR REIMAGINE COMPONENTS
- "update" means make a small change, NOT redesign the entire component
- "change X to Y" means ONLY change X to Y, nothing else
- "fix" means repair what's broken, NOT rewrite everything
- "remove X" means delete X from the existing file, NOT create a new file
- "delete X" means remove X from where it currently exists
- Preserve ALL existing functionality and design unless explicitly asked to change it

NEVER CREATE NEW FILES WHEN THE USER ASKS TO REMOVE/DELETE SOMETHING
If the user says "remove X", you must:
1. Find which existing file contains X
2. Edit that file to remove X
3. DO NOT create any new files

${l?`
TARGETED EDIT MODE ACTIVE
- Edit Type: ${l.editIntent.type}
- Confidence: ${l.editIntent.confidence}
- Files to Edit: ${l.primaryFiles.join(", ")}

\u{1F6A8} CRITICAL RULE - VIOLATION WILL RESULT IN FAILURE \u{1F6A8}
YOU MUST ***ONLY*** GENERATE THE FILES LISTED ABOVE!

ABSOLUTE REQUIREMENTS:
1. COUNT the files in "Files to Edit" - that's EXACTLY how many files you must generate
2. If "Files to Edit" shows ONE file, generate ONLY that ONE file
3. DO NOT generate App.jsx unless it's EXPLICITLY listed in "Files to Edit"
4. DO NOT generate ANY components that aren't listed in "Files to Edit"
5. DO NOT "helpfully" update related files
6. DO NOT fix unrelated issues you notice
7. DO NOT improve code quality in files not being edited
8. DO NOT add bonus features

EXAMPLE VIOLATIONS (THESE ARE FAILURES):
\u274C User says "update the hero" \u2192 You update Hero, Header, Footer, and App.jsx
\u274C User says "change header color" \u2192 You redesign the entire header
\u274C User says "fix the button" \u2192 You update multiple components
\u274C Files to Edit shows "Hero.jsx" \u2192 You also generate App.jsx "to integrate it"
\u274C Files to Edit shows "Header.jsx" \u2192 You also update Footer.jsx "for consistency"

CORRECT BEHAVIOR (THIS IS SUCCESS):
\u2705 User says "update the hero" \u2192 You ONLY edit Hero.jsx with the requested change
\u2705 User says "change header color" \u2192 You ONLY change the color in Header.jsx
\u2705 User says "fix the button" \u2192 You ONLY fix the specific button issue
\u2705 Files to Edit shows "Hero.jsx" \u2192 You generate ONLY Hero.jsx
\u2705 Files to Edit shows "Header.jsx, Nav.jsx" \u2192 You generate EXACTLY 2 files: Header.jsx and Nav.jsx

THE AI INTENT ANALYZER HAS ALREADY DETERMINED THE FILES.
DO NOT SECOND-GUESS IT.
DO NOT ADD MORE FILES.
ONLY OUTPUT THE EXACT FILES LISTED IN "Files to Edit".
`:""}

VIOLATION OF THESE RULES WILL RESULT IN FAILURE!
`:""}

CRITICAL INCREMENTAL UPDATE RULES:
- When the user asks for additions or modifications (like "add a videos page", "create a new component", "update the header"):
  - DO NOT regenerate the entire application
  - DO NOT recreate files that already exist unless explicitly asked
  - ONLY create/modify the specific files needed for the requested change
  - Preserve all existing functionality and files
  - If adding a new page/route, integrate it with the existing routing system
  - Reference existing components and styles rather than duplicating them
  - NEVER recreate config files (tailwind.config.js, vite.config.js, package.json, etc.)

IMPORTANT: When the user asks for edits or modifications:
- You have access to the current file contents in the context
- Make targeted changes to existing files rather than regenerating everything
- Preserve the existing structure and only modify what's requested
- If you need to see a specific file that's not in context, mention it

IMPORTANT: You have access to the full conversation context including:
- Previously scraped websites and their content
- Components already generated and applied
- The current project being worked on
- Recent conversation history
- Any Vite errors that need to be resolved

When the user references "the app", "the website", or "the site" without specifics, refer to:
1. The most recently scraped website in the context
2. The current project name in the context
3. The files currently in the sandbox

If you see scraped websites in the context, you're working on a clone/recreation of that site.

CRITICAL UI/UX RULES:
- NEVER use emojis in any code, text, console logs, or UI elements
- ALWAYS ensure responsive design using proper Tailwind classes (sm:, md:, lg:, xl:)
- ALWAYS use proper mobile-first responsive design patterns
- NEVER hardcode pixel widths - use relative units and responsive classes
- ALWAYS test that the layout works on mobile devices (320px and up)
- ALWAYS make sections full-width by default - avoid max-w-7xl or similar constraints
- For full-width layouts: use className="w-full" or no width constraint at all
- Only add max-width constraints when explicitly needed for readability (like blog posts)
- Prefer system fonts and clean typography
- Ensure all interactive elements have proper hover/focus states
- Use proper semantic HTML elements for accessibility

CRITICAL STYLING RULES - MUST FOLLOW:
- NEVER use inline styles with style={{ }} in JSX
- NEVER use <style jsx> tags or any CSS-in-JS solutions
- NEVER create App.css, Component.css, or any component-specific CSS files
- NEVER import './App.css' or any CSS files except index.css
- ALWAYS use Tailwind CSS classes for ALL styling
- ONLY create src/index.css with the @tailwind directives
- The ONLY CSS file should be src/index.css with:
  @tailwind base;
  @tailwind components;
  @tailwind utilities;
- Use Tailwind's full utility set: spacing, colors, typography, flexbox, grid, animations, etc.
- ALWAYS add smooth transitions and animations where appropriate:
  - Use transition-all, transition-colors, transition-opacity for hover states
  - Use animate-fade-in, animate-pulse, animate-bounce for engaging UI elements
  - Add hover:scale-105 or hover:scale-110 for interactive elements
  - Use transform and transition utilities for smooth interactions
- For complex layouts, combine Tailwind utilities rather than writing custom CSS
- NEVER use non-standard Tailwind classes like "border-border", "bg-background", "text-foreground", etc.
- Use standard Tailwind classes only:
  - For borders: use "border-gray-200", "border-gray-300", etc. NOT "border-border"
  - For backgrounds: use "bg-white", "bg-gray-100", etc. NOT "bg-background"
  - For text: use "text-gray-900", "text-black", etc. NOT "text-foreground"
- Examples of good Tailwind usage:
  - Buttons: className="px-4 py-2 bg-blue-600 text-white rounded-lg shadow-md hover:bg-blue-700 hover:shadow-lg transform hover:scale-105 transition-all duration-200"
  - Cards: className="bg-white rounded-lg shadow-md p-6 border border-gray-200 hover:shadow-xl transition-shadow duration-300"
  - Full-width sections: className="w-full px-4 sm:px-6 lg:px-8"
  - Constrained content (only when needed): className="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8"
  - Dark backgrounds: className="min-h-screen bg-gray-900 text-white"
  - Hero sections: className="animate-fade-in-up"
  - Feature cards: className="transform hover:scale-105 transition-transform duration-300"
  - CTAs: className="animate-pulse hover:animate-none"

CRITICAL STRING AND SYNTAX RULES:
- ALWAYS escape apostrophes in strings: use ' instead of ' or use double quotes
- ALWAYS escape quotes properly in JSX attributes
- NEVER use curly quotes or smart quotes ('' "" '' "") - only straight quotes (' ")
- ALWAYS convert smart/curly quotes to straight quotes:
  - ' and ' \u2192 '
  - " and " \u2192 "
  - Any other Unicode quotes \u2192 straight quotes
- When strings contain apostrophes, either:
  1. Use double quotes: "you're" instead of 'you're'
  2. Escape the apostrophe: 'you're'
- When working with scraped content, ALWAYS sanitize quotes first
- Replace all smart quotes with straight quotes before using in code
- Be extra careful with user-generated content or scraped text
- Always validate that JSX syntax is correct before generating

CRITICAL CODE SNIPPET DISPLAY RULES:
- When displaying code examples in JSX, NEVER put raw curly braces { } in text
- ALWAYS wrap code snippets in template literals with backticks
- For code examples in components, use one of these patterns:
  1. Template literals: <div>{\`const example = { key: 'value' }\`}</div>
  2. Pre/code blocks: <pre><code>{\`your code here\`}</code></pre>
  3. Escape braces: <div>{'{'}key: value{'}'}</div>
- NEVER do this: <div>const example = { key: 'value' }</div> (causes parse errors)
- For multi-line code snippets, always use:
  <pre className="bg-gray-900 text-gray-100 p-4 rounded">
    <code>{\`
      // Your code here
      const example = {
        key: 'value'
      }
    \`}</code>
  </pre>

CRITICAL: When asked to create a React app or components:
- ALWAYS CREATE ALL FILES IN FULL - never provide partial implementations
- ALWAYS CREATE EVERY COMPONENT that you import - no placeholders
- ALWAYS IMPLEMENT COMPLETE FUNCTIONALITY - don't leave TODOs unless explicitly asked
- If you're recreating a website, implement ALL sections and features completely
- NEVER create tailwind.config.js - it's already configured in the template
- ALWAYS include a Navigation/Header component (Nav.jsx or Header.jsx) - websites need navigation!

REQUIRED COMPONENTS for website clones:
1. Nav.jsx or Header.jsx - Navigation bar with links (NEVER SKIP THIS!)
2. Hero.jsx - Main landing section
3. Features/Services/Products sections - Based on the site content
4. Footer.jsx - Footer with links and info
5. App.jsx - Main component that imports and arranges all components
- NEVER create vite.config.js - it's already configured in the template
- NEVER create package.json - it's already configured in the template

WHEN WORKING WITH SCRAPED CONTENT:
- ALWAYS sanitize all text content before using in code
- Convert ALL smart quotes to straight quotes
- Example transformations:
  - "Firecrawl's API" \u2192 "Firecrawl's API" or "Firecrawl\\'s API"
  - 'It's amazing' \u2192 "It's amazing" or 'It\\'s amazing'
  - "Best tool ever" \u2192 "Best tool ever"
- When in doubt, use double quotes for strings containing apostrophes
- For testimonials or quotes from scraped content, ALWAYS clean the text:
  - Bad: content: 'Moved our internal agent's web scraping...'
  - Good: content: "Moved our internal agent's web scraping..."
  - Also good: content: 'Moved our internal agent\\'s web scraping...'

When generating code, FOLLOW THIS PROCESS:
1. ALWAYS generate src/index.css FIRST - this establishes the styling foundation
2. List ALL components you plan to import in App.jsx
3. Count them - if there are 10 imports, you MUST create 10 component files
4. Generate src/index.css first (with proper CSS reset and base styles)
5. Generate App.jsx second
6. Then generate EVERY SINGLE component file you imported
7. Do NOT stop until all imports are satisfied

Use this XML format for React components only (DO NOT create tailwind.config.js - it already exists):

<file path="src/index.css">
@tailwind base;
@tailwind components;
@tailwind utilities;
</file>

<file path="src/App.jsx">
// Main App component that imports and uses other components
// Use Tailwind classes: className="min-h-screen bg-gray-50"
</file>

<file path="src/components/Example.jsx">
// Your React component code here
// Use Tailwind classes for ALL styling
</file>

CRITICAL COMPLETION RULES:
1. NEVER say "I'll continue with the remaining components"
2. NEVER say "Would you like me to proceed?"
3. NEVER use <continue> tags
4. Generate ALL components in ONE response
5. If App.jsx imports 10 components, generate ALL 10
6. Complete EVERYTHING before ending your response

With 16,000 tokens available, you have plenty of space to generate a complete application. Use it!

UNDERSTANDING USER INTENT FOR INCREMENTAL VS FULL GENERATION:
- "add/create/make a [specific feature]" \u2192 Add ONLY that feature to existing app
- "add a videos page" \u2192 Create ONLY Videos.jsx and update routing
- "update the header" \u2192 Modify ONLY header component
- "fix the styling" \u2192 Update ONLY the affected components
- "change X to Y" \u2192 Find the file containing X and modify it
- "make the header black" \u2192 Find Header component and change its color
- "rebuild/recreate/start over" \u2192 Full regeneration
- Default to incremental updates when working on an existing app

SURGICAL EDIT RULES (CRITICAL FOR PERFORMANCE):
- **PREFER TARGETED CHANGES**: Don't regenerate entire components for small edits
- For color/style changes: Edit ONLY the specific className or style prop
- For text changes: Change ONLY the text content, keep everything else
- For adding elements: INSERT into existing JSX, don't rewrite the whole return
- **PRESERVE EXISTING CODE**: Keep all imports, functions, and unrelated code exactly as-is
- Maximum files to edit:
  - Style change = 1 file ONLY
  - Text change = 1 file ONLY
  - New feature = 2 files MAX (feature + parent)
- If you're editing >3 files for a simple request, STOP - you're doing too much

EXAMPLES OF CORRECT SURGICAL EDITS:
\u2705 "change header to black" \u2192 Find className="..." in Header.jsx, change ONLY color classes
\u2705 "update hero text" \u2192 Find the <h1> or <p> in Hero.jsx, change ONLY the text inside
\u2705 "add a button to hero" \u2192 Find the return statement, ADD button, keep everything else
\u274C WRONG: Regenerating entire Header.jsx to change one color
\u274C WRONG: Rewriting Hero.jsx to add one button

NAVIGATION/HEADER INTELLIGENCE:
- ALWAYS check App.jsx imports first
- Navigation is usually INSIDE Header.jsx, not separate
- If user says "nav", check Header.jsx FIRST
- Only create Nav.jsx if no navigation exists anywhere
- Logo, menu, hamburger = all typically in Header

CRITICAL: When files are provided in the context:
1. The user is asking you to MODIFY the existing app, not create a new one
2. Find the relevant file(s) from the provided context
3. Generate ONLY the files that need changes
4. Do NOT ask to see files - they are already provided in the context above
5. Make the requested change immediately`,L=h;if(E){let t=[];E.sandboxId&&t.push(`Current sandbox ID: ${E.sandboxId}`),E.structure&&t.push(`Current file structure:
${E.structure}`);let _=u.sandboxState?.fileCache?.files||{},T=Object.keys(_).length>0;if(console.log("[generate-ai-code-stream] Backend file cache status:"),console.log("[generate-ai-code-stream] - Has sandboxState:",!!u.sandboxState),console.log("[generate-ai-code-stream] - Has fileCache:",!!u.sandboxState?.fileCache),console.log("[generate-ai-code-stream] - File count:",Object.keys(_).length),console.log("[generate-ai-code-stream] - Has manifest:",!!u.sandboxState?.fileCache?.manifest),!T&&j&&(u.activeSandbox||E?.sandboxId)){console.log("[generate-ai-code-stream] No backend files, attempting to fetch from sandbox...");try{let c=await fetch(`${process.env.NEXT_PUBLIC_APP_URL||"http://localhost:3000"}/api/get-sandbox-files`,{method:"GET",headers:{"Content-Type":"application/json"}});if(c.ok){let i=await c.json();if(i.success&&i.files){console.log("[generate-ai-code-stream] Successfully fetched",Object.keys(i.files).length,"files from sandbox"),u.sandboxState?u.sandboxState.fileCache||(u.sandboxState.fileCache={files:{},lastSync:Date.now(),sandboxId:E?.sandboxId||"unknown"}):u.sandboxState={fileCache:{files:{},lastSync:Date.now(),sandboxId:E?.sandboxId||"unknown"}};let r=u.sandboxState?.fileCache;for(let[s,w]of(r||(u.sandboxState||(u.sandboxState={}),u.sandboxState.fileCache={files:{},lastSync:Date.now(),sandboxId:E?.sandboxId||"unknown"},r=u.sandboxState.fileCache),Object.entries(i.files))){let o=s.replace("/home/user/app/","");r.files[o]={content:w,lastModified:Date.now()}}if(i.manifest&&(u.sandboxState?u.sandboxState.fileCache||(u.sandboxState.fileCache={files:{},lastSync:Date.now(),sandboxId:E?.sandboxId||"unknown"}):u.sandboxState={fileCache:{files:{},lastSync:Date.now(),sandboxId:E?.sandboxId||"unknown"}},u.sandboxState.fileCache.manifest=i.manifest,!l)){console.log("[generate-ai-code-stream] Analyzing edit intent with fetched manifest");try{let s=await fetch(`${process.env.NEXT_PUBLIC_APP_URL||"http://localhost:3000"}/api/analyze-edit-intent`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({prompt:h,manifest:i.manifest,model:m})});if(s.ok){let{searchPlan:w}=await s.json();console.log("[generate-ai-code-stream] Search plan received:",w);let o=le(h,i.manifest);l=o,W=o.systemPrompt,console.log("[generate-ai-code-stream] Edit context created with",l.primaryFiles.length,"primary files")}}catch(s){console.error("[generate-ai-code-stream] Failed to analyze edit intent:",s)}}_=(u.sandboxState&&u.sandboxState.fileCache?u.sandboxState.fileCache:{files:{}}).files||{},T=Object.keys(_).length>0,console.log("[generate-ai-code-stream] Updated backend cache with fetched files")}}}catch(c){console.error("[generate-ai-code-stream] Failed to fetch sandbox files:",c)}}if(T)if(l&&l.primaryFiles.length>0){t.push(`
EXISTING APPLICATION - TARGETED EDIT MODE`),t.push(`
${l.systemPrompt||W}
`);let c=await fe(l.primaryFiles,n.g.sandboxState.fileCache.manifest),i=await fe(l.contextFiles,n.g.sandboxState.fileCache.manifest),r=function(s,w){let o=[];for(let[I,O]of(o.push(`## Files to Edit (ONLY OUTPUT THESE FILES)
`),o.push(`\u{1F6A8} You MUST ONLY generate the files listed below. Do NOT generate any other files! \u{1F6A8}
`),o.push(`\u26A0\uFE0F CRITICAL: Return the COMPLETE file - NEVER truncate with "..." or skip any lines! \u26A0\uFE0F
`),o.push(`The file MUST include ALL imports, ALL functions, ALL JSX, and ALL closing tags.

`),Object.entries(s)))o.push(`### ${I}
**IMPORTANT: This is the COMPLETE file. Your output must include EVERY line shown below, modified only where necessary.**
\`\`\`${Ye(I)}
${O}
\`\`\`
`);if(Object.keys(w).length>0)for(let[I,O]of(o.push(`
## Context Files (Reference Only - Do Not Edit)
`),Object.entries(w))){let F=O;O.length>2e3&&(F=O.substring(0,2e3)+`
// ... [truncated for context length]`),o.push(`### ${I}
\`\`\`${Ye(I)}
${F}
\`\`\`
`)}return o.join(`
`)}(c,i);t.push(r),t.push(`
IMPORTANT: Only modify the files listed under "Files to Edit". The context files are provided for reference only.`)}else{console.log("[generate-ai-code-stream] WARNING: Using fallback mode - no edit context available"),t.push(`
EXISTING APPLICATION - TARGETED EDIT REQUIRED`),t.push(`
You MUST analyze the user request and determine which specific file(s) to edit.`),t.push(`
Current project files (DO NOT regenerate all of these):`);let c=Object.entries(_);for(let[i]of(console.log(`[generate-ai-code-stream] Using backend cache: ${c.length} files`),t.push(`
### File List:`),c))t.push(`- ${i}`);for(let[i,r]of(t.push(`
### File Contents (ALL FILES FOR CONTEXT):`),c)){let s=r.content;typeof s=="string"&&t.push(`
<file path="${i}">
${s}
</file>`)}t.push(`
\u{1F6A8} CRITICAL INSTRUCTIONS - VIOLATION = FAILURE \u{1F6A8}`),t.push('1. Analyze the user request: "'+h+'"'),t.push("2. Identify the MINIMUM number of files that need editing (usually just ONE)"),t.push("3. PRESERVE ALL EXISTING CONTENT in those files"),t.push("4. ONLY ADD/MODIFY the specific part requested"),t.push("5. DO NOT regenerate entire components from scratch"),t.push("6. DO NOT change unrelated parts of any file"),t.push("7. Generate ONLY the files that MUST be changed - NO EXTRAS"),t.push(`
\u26A0\uFE0F FILE COUNT RULE:`),t.push("- Simple change (color, text, spacing) = 1 file ONLY"),t.push("- Adding new component = 2 files MAX (new component + parent that imports it)"),t.push("- DO NOT exceed these limits unless absolutely necessary"),t.push(`
EXAMPLES OF CORRECT BEHAVIOR:`),t.push('\u2705 "add a chart to the hero" \u2192 Edit ONLY Hero.jsx, ADD the chart, KEEP everything else'),t.push('\u2705 "change header to black" \u2192 Edit ONLY Header.jsx, change ONLY the color'),t.push('\u2705 "fix spacing in footer" \u2192 Edit ONLY Footer.jsx, adjust ONLY spacing'),t.push(`
EXAMPLES OF FAILURES:`),t.push('\u274C "change header color" \u2192 You edit Header, Footer, and App "for consistency"'),t.push('\u274C "add chart to hero" \u2192 You regenerate the entire Hero component'),t.push('\u274C "fix button" \u2192 You update 5 different component files'),t.push(`
\u26A0\uFE0F FINAL WARNING:`),t.push("If you generate MORE files than necessary, you have FAILED"),t.push("If you DELETE or REWRITE existing functionality, you have FAILED"),t.push("ONLY change what was EXPLICITLY requested - NOTHING MORE")}else if(E.currentFiles&&Object.keys(E.currentFiles).length>0){for(let[c,i]of(console.log("[generate-ai-code-stream] Warning: Backend cache empty, using frontend files"),t.push(`
EXISTING APPLICATION - DO NOT REGENERATE FROM SCRATCH`),t.push("Current project files (modify these, do not recreate):"),Object.entries(E.currentFiles)))typeof i=="string"&&t.push(`
<file path="${c}">
${i}
</file>`);t.push(`
The above files already exist. When the user asks to modify something (like "change the header color to black"), find the relevant file above and generate ONLY that file with the requested changes.`)}j?(t.push(`
EDIT MODE ACTIVE`),t.push("This is an incremental update to an existing application."),t.push("DO NOT regenerate App.jsx, index.css, or other core files unless explicitly requested."),t.push("ONLY create or modify the specific files needed for the user's request."),t.push(`
\u26A0\uFE0F CRITICAL FILE OUTPUT FORMAT - VIOLATION = FAILURE:`),t.push("YOU MUST OUTPUT EVERY FILE IN THIS EXACT XML FORMAT:"),t.push('<file path="src/components/ComponentName.jsx">'),t.push("// Complete file content here"),t.push("</file>"),t.push('<file path="src/index.css">'),t.push("/* CSS content here */"),t.push("</file>"),t.push(`
\u274C NEVER OUTPUT: "Generated Files: index.css, App.jsx"`),t.push("\u274C NEVER LIST FILE NAMES WITHOUT CONTENT"),t.push("\u2705 ALWAYS: One <file> tag per file with COMPLETE content"),t.push("\u2705 ALWAYS: Include EVERY file you modified")):T||(t.push(`
\u{1F3A8} FIRST GENERATION MODE - CREATE SOMETHING BEAUTIFUL!`),t.push(`
This is the user's FIRST experience. Make it impressive:`),t.push("1. **USE TAILWIND PROPERLY** - Use standard Tailwind color classes"),t.push("2. **NO PLACEHOLDERS** - Use real content, not lorem ipsum"),t.push("3. **COMPLETE COMPONENTS** - Header, Hero, Features, Footer minimum"),t.push("4. **VISUAL POLISH** - Shadows, hover states, transitions"),t.push("5. **STANDARD CLASSES** - bg-white, text-gray-900, bg-blue-500, NOT bg-background"),t.push(`
Create a polished, professional application that works perfectly on first load.`),t.push(`
\u26A0\uFE0F OUTPUT FORMAT:`),t.push('Use <file path="...">content</file> tags for EVERY file'),t.push('NEVER output "Generated Files:" as plain text')),E.conversationContext&&(E.conversationContext.scrapedWebsites?.length>0&&(t.push(`
Scraped Websites in Context:`),E.conversationContext.scrapedWebsites.forEach(c=>{if(t.push(`
URL: ${c.url}`),t.push(`Scraped: ${new Date(c.timestamp).toLocaleString()}`),c.content){let i=typeof c.content=="string"?c.content.substring(0,1e3):JSON.stringify(c.content).substring(0,1e3);t.push(`Content Preview: ${i}...`)}})),E.conversationContext.currentProject&&t.push(`
Current Project: ${E.conversationContext.currentProject}`)),t.length>0&&(L=`CONTEXT:
${t.join(`
`)}

USER REQUEST:
${h}`)}await k({type:"status",message:"Planning application structure..."}),console.log(`
[generate-ai-code-stream] Starting streaming response...
`);let A=[],S=m.startsWith("anthropic/"),f=m.startsWith("google/"),d=m.startsWith("openai/gpt-5"),C=S?m.replace("anthropic/",""):m==="openai/gpt-5"?"gpt-5":f?m.replace("google/",""):m,p={model:(S?dt:d?pt:f?ut:lt)(C),messages:[{role:"system",content:oe+`

\u{1F6A8} CRITICAL CODE GENERATION RULES - VIOLATION = FAILURE \u{1F6A8}:
1. NEVER truncate ANY code - ALWAYS write COMPLETE files
2. NEVER use "..." anywhere in your code - this causes syntax errors
3. NEVER cut off strings mid-sentence - COMPLETE every string
4. NEVER leave incomplete class names or attributes
5. ALWAYS close ALL tags, quotes, brackets, and parentheses
6. If you run out of space, prioritize completing the current file

CRITICAL STRING RULES TO PREVENT SYNTAX ERRORS:
- NEVER write: className="px-8 py-4 bg-black text-white font-bold neobrut-border neobr...
- ALWAYS write: className="px-8 py-4 bg-black text-white font-bold neobrut-border neobrut-shadow"
- COMPLETE every className attribute
- COMPLETE every string literal
- NO ellipsis (...) ANYWHERE in code

PACKAGE RULES:
- For INITIAL generation: Use ONLY React, no external packages
- For EDITS: You may use packages, specify them with <package> tags
- NEVER install packages like @mendable/firecrawl-js unless explicitly requested

Examples of SYNTAX ERRORS (NEVER DO THIS):
\u274C className="px-4 py-2 bg-blue-600 hover:bg-blue-7...
\u274C <button className="btn btn-primary btn-...
\u274C const title = "Welcome to our...
\u274C import { useState, useEffect, ... } from 'react'

Examples of CORRECT CODE (ALWAYS DO THIS):
\u2705 className="px-4 py-2 bg-blue-600 hover:bg-blue-700"
\u2705 <button className="btn btn-primary btn-large">
\u2705 const title = "Welcome to our application"
\u2705 import { useState, useEffect, useCallback } from 'react'

REMEMBER: It's better to generate fewer COMPLETE files than many INCOMPLETE files.`},{role:"user",content:L+`

CRITICAL: You MUST complete EVERY file you start. If you write:
<file path="src/components/Hero.jsx">

You MUST include the closing </file> tag and ALL the code in between.

NEVER write partial code like:
<h1>Build and deploy on the AI Cloud.</h1>
<p>Some text...</p>  \u274C WRONG

ALWAYS write complete code:
<h1>Build and deploy on the AI Cloud.</h1>
<p>Some text here with full content</p>  \u2705 CORRECT

If you're running out of space, generate FEWER files but make them COMPLETE.
It's better to have 3 complete files than 10 incomplete files.`}],stopSequences:[]};m.startsWith("openai/gpt-5")||(p.temperature=.7),d&&(p.experimental_providerMetadata={openai:{reasoningEffort:"high"}});let y=await(0,N.gM)(p),P="",J="",me="",te=0,xe=!1,ae=!1,ie="",ke="";for await(let t of y.textStream){let _=t||"";P+=_,J+=_;let T=ke+_,c=/<(file|package|packages|explanation|command|structure|template)\b/.test(_),i=/<\/(file|package|packages|explanation|command|structure|template)>/.test(_);c&&(ie.trim()&&!ae&&(await k({type:"conversation",text:ie.trim()}),ie=""),ae=!0),i&&(ae=!1),ae||c||(ie+=_),await k({type:"stream",text:_,raw:!0});let r=0;if(j){let s,w=/<package>([^<]+)<\/package>/g;for(;(s=w.exec(T))!==null;){let o=s[1].trim();o&&!A.includes(o)&&(A.push(o),console.log(`[generate-ai-code-stream] Package detected: ${o}`),await k({type:"package",name:o,message:`Package detected: ${o}`})),r=s.index+s[0].length}}if(ke=T.substring(Math.max(0,r-50)),_.includes('<file path="')){let s=_.match(/<file path="([^"]+)"/);s&&(me=s[1],xe=!0,J=_)}if(xe&&J.includes("</file>")){if(xe=!1,me.includes("components/")){te++;let s=me.split("/").pop()?.replace(".jsx","")||"Component";await k({type:"component",name:s,path:me,index:te})}else me.includes("App.jsx")&&await k({type:"app",message:"Generated main App.jsx",path:me});J="",me=""}}if(console.log(`

[generate-ai-code-stream] Streaming complete.`),ie.trim()&&await k({type:"conversation",text:ie.trim()}),j){let t,_=/<packages>([\s\S]*?)<\/packages>/g;for(;(t=_.exec(P))!==null;)for(let T of t[1].trim().split(/[\n,]+/).map(c=>c.trim()).filter(c=>c.length>0))A.includes(T)||(A.push(T),console.log(`[generate-ai-code-stream] Package from <packages> tag: ${T}`),await k({type:"package",name:T,message:`Package detected: ${T}`}))}let Pe=/<file path="([^"]+)">([\s\S]*?)<\/file>/g,ne=[];for(;($=Pe.exec(P))!==null;){let t=$[1],_=$[2].trim();if(ne.push({path:t,content:_}),j)for(let T of function(c){let i,r=[],s=/import\s+(?:(?:\{[^}]*\}|\*\s+as\s+\w+|\w+)(?:\s*,\s*(?:\{[^}]*\}|\*\s+as\s+\w+|\w+))*\s+from\s+)?['"]([^'"]+)['"]/g;for(;(i=s.exec(c))!==null;){let w=i[1];if(!w.startsWith(".")&&!w.startsWith("/")&&w!=="react"&&w!=="react-dom"&&!w.startsWith("@/")){let o=w.startsWith("@")?w.split("/").slice(0,2).join("/"):w.split("/")[0];r.includes(o)||r.push(o)}}return r}(_))A.includes(T)||(A.push(T),console.log(`[generate-ai-code-stream] Package detected from imports: ${T}`),await k({type:"package",name:T,message:`Package detected from imports: ${T}`}));if(t.includes("components/")){let T=t.split("/").pop()?.replace(".jsx","")||"Component";await k({type:"component",name:T,path:t,index:te})}else t.includes("App.jsx")&&await k({type:"app",message:"Generated main App.jsx",path:t})}let Re=P.match(/<explanation>([\s\S]*?)<\/explanation>/),He=Re?Re[1].trim():"Code generated successfully!",B=[],De=(P.match(/<file path="/g)||[]).length,$e=(P.match(/<\/file>/g)||[]).length;De!==$e&&B.push(`Unclosed file tags detected: ${De} open, ${$e} closed`);let We=/<file path="([^"]+)">([\s\S]*?)(?:<\/file>|$)/g;for(;(ye=We.exec(P))!==null;){let t=ye[1],_=ye[2];if((_.trim().endsWith("<")||_.trim().endsWith("</"))&&B.push(`File ${t} appears to have incomplete HTML tags`),t.match(/\.(jsx?|tsx?)$/)){let T=(_.match(/{/g)||[]).length,c=(_.match(/}/g)||[]).length;Math.abs(T-c)>3&&B.push(`File ${t} has severely unmatched braces (${T} open, ${c} closed)`),_.length<20&&_.includes("function")&&!_.includes("}")&&B.push(`File ${t} appears severely truncated`)}}if(B.length>0&&ct.UO.codeApplication.enableTruncationRecovery){let t;console.warn("[generate-ai-code-stream] Truncation detected, attempting to fix:",B),await k({type:"warning",message:"Detected incomplete code generation. Attempting to complete...",warnings:B});let _=[],T=/<file path="([^"]+)">([\s\S]*?)(?:<\/file>|$)/g;for(;(t=T.exec(P))!==null;){let c=t[1],i=t[2],r=i.includes("...")&&!i.includes("...rest")&&!i.includes("...props")&&!i.includes("spread"),s=i.trim().endsWith("...")||i.trim().endsWith(",")||i.trim().endsWith("("),w=i.includes("</")&&!i.match(/<\/[a-zA-Z0-9]+>/)&&i.includes("<"),o=i.length<50&&c.match(/\.(jsx?|tsx?)$/),I=(i.match(/{/g)||[]).length,O=(i.match(/}/g)||[]).length,F=Math.abs(I-O)>1;(r&&s||w||o&&!i.includes("export")||F)&&_.push(c)}if(_.length>0){for(let c of(console.log("[generate-ai-code-stream] Attempting to regenerate truncated files:",_),_)){await k({type:"info",message:`Completing ${c}...`});try{let i,r=`Complete the following file that was truncated. Provide the FULL file content.
                
File: ${c}
Original request: ${h}
                
Provide the complete file content without any truncation. Include all necessary imports, complete all functions, and close all tags properly.`;m.includes("gpt")||m.startsWith("openai/")?i=pt:m.includes("claude")||m.startsWith("anthropic/")?i=dt:m.includes("gemini")||m.startsWith("google/")?i=ut:(m.startsWith("groq/"),i=lt);let s=m;s.startsWith("openai/")?s=s.replace("openai/",""):s.startsWith("anthropic/")?s=s.replace("anthropic/",""):s.startsWith("google/")?s=s.replace("google/",""):s.startsWith("groq/")&&(s=s.replace("groq/",""));let w=await(0,N.gM)({model:i(s),messages:[{role:"system",content:"You are completing a truncated file. Provide the complete, working file content."},{role:"user",content:r}],temperature:m.startsWith("openai/gpt-5")?void 0:ct.UO.ai.defaultTemperature}),o="";for await(let F of w.textStream)o+=F;let I=RegExp(`<file path="${c.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}">[\\s\\S]*?(?:</file>|$)`,"g"),O=o;if(O.includes("```")){let F=O.match(/```[\w]*\n([\s\S]*?)```/);F&&(O=F[1])}P=P.replace(I,`<file path="${c}">
${O}
</file>`),console.log(`[generate-ai-code-stream] Successfully completed ${c}`)}catch(i){console.error(`[generate-ai-code-stream] Failed to complete ${c}:`,i),await k({type:"warning",message:`Could not auto-complete ${c}. Manual review may be needed.`})}}B.length=0,await k({type:"info",message:"Truncation recovery complete"})}}if(await k({type:"complete",generatedCode:P,explanation:He,files:ne.length,components:te,model:m,packagesToInstall:A.length>0?A:void 0,warnings:B.length>0?B:void 0}),j&&l&&n.g.conversationState){let t={timestamp:Date.now(),userRequest:h,editType:l.editIntent.type,targetFiles:l.primaryFiles,confidence:l.editIntent.confidence,outcome:"success"};n.g.conversationState.context.edits.push(t),(l.editIntent.type==="ADD_FEATURE"||ne.length>3)&&n.g.conversationState.context.projectEvolution.majorChanges.push({timestamp:Date.now(),description:l.editIntent.description,filesAffected:l.primaryFiles}),n.g.conversationState.lastUpdated=Date.now(),console.log("[generate-ai-code-stream] Updated conversation history with edit:",t)}}catch($){console.error("[generate-ai-code-stream] Stream processing error:",$),$.message?.includes("tool call validation failed")?(console.error("[generate-ai-code-stream] Tool call validation error - this may be due to the AI model sending incorrect parameters"),await k({type:"warning",message:"Package installation tool encountered an issue. Packages will be detected from imports instead."})):await k({type:"error",error:$.message})}finally{await z.close()}})(),new Response(he.readable,{headers:{"Content-Type":"text/event-stream","Cache-Control":"no-cache",Connection:"keep-alive"}})}catch(h){return console.error("[generate-ai-code-stream] Error:",h),Me.Rp.json({success:!1,error:h.message},{status:500})}}var Nt=n(5356).Buffer;let _e=new ce.AppRouteRouteModule({definition:{kind:de.A.APP_ROUTE,page:"/api/generate-ai-code-stream/route",pathname:"/api/generate-ai-code-stream",filename:"route",bundlePath:"app/api/generate-ai-code-stream/route"},distDir:process.env.__NEXT_RELATIVE_DIST_DIR||"",projectDir:process.env.__NEXT_RELATIVE_PROJECT_DIR||"",resolvedPagePath:"/workspace/app/api/generate-ai-code-stream/route.ts",nextConfigOutput:"",userland:H}),{workAsyncStorage:ht,workUnitAsyncStorage:mt,serverHooks:wt}=_e;function Ot(){return(0,ue.V5)({workAsyncStorage:ht,workUnitAsyncStorage:mt})}async function bt(x,h,m){var E;let j="/api/generate-ai-code-stream/route";j==="/index"&&(j="/");let X=await _e.prepare(x,h,{srcPage:j,multiZoneDraftMode:"false"});if(!X)return h.statusCode=400,h.end("Bad Request"),m.waitUntil==null||m.waitUntil.call(m,Promise.resolve()),null;let{buildId:G,params:he,nextConfig:z,isDraftMode:k,prerenderManifest:$,routerServerContext:ye,isOnDemandRevalidate:l,revalidateOnlyGenerated:W,resolvedPathname:M}=X,oe=(0,Fe.Y)(j),L=!!($.dynamicRoutes[oe]||$.routes[M]);if(L&&!k){let te=!!$.routes[M],xe=$.dynamicRoutes[oe];if(xe&&xe.fallback===!1&&!te)throw new Ze.G}let A=null;!L||_e.isDev||k||(A=(A=M)==="/index"?"/":A);let S=_e.isDev===!0||!L,f=L&&!S,d=x.method||"GET",C=(0,Oe.EK)(),p=C.getActiveScopeSpan(),y={params:he,prerenderManifest:$,renderOpts:{experimental:{dynamicIO:!!z.experimental.dynamicIO,authInterrupts:!!z.experimental.authInterrupts},supportsDynamicResponse:S,incrementalCache:(0,pe.Ny)(x,"incrementalCache"),cacheLifeProfiles:(E=z.experimental)==null?void 0:E.cacheLife,isRevalidate:f,waitUntil:m.waitUntil,onClose:te=>{h.on("close",te)},onAfterTaskError:void 0,onInstrumentationRequestError:(te,xe,ae)=>_e.onRequestError(x,te,ae,ye)},sharedContext:{buildId:G}},P=new Ie.j(x),J=new Ie.p(h),me=ve.u_.fromNodeNextRequest(P,(0,ve.SN)(h));try{let te=async ae=>_e.handle(me,y).finally(()=>{if(!ae)return;ae.setAttributes({"http.status_code":h.statusCode,"next.rsc":!1});let ie=C.getRootSpanAttributes();if(!ie)return;if(ie.get("next.span_type")!==Ce.Li.handleRequest)return void console.warn(`Unexpected root span type '${ie.get("next.span_type")}'. Please report this Next.js issue https://github.com/vercel/next.js`);let ke=ie.get("next.route");if(ke){let Pe=`${d} ${ke}`;ae.setAttributes({"next.route":ke,"http.route":ke,"next.span_name":Pe}),ae.updateName(Pe)}else ae.updateName(`${d} ${x.url}`)}),xe=async ae=>{var ie,ke;let Pe=async({previousCacheEntry:He})=>{try{if(!(0,pe.Ny)(x,"minimalMode")&&l&&W&&!He)return h.statusCode=404,h.setHeader("x-nextjs-cache","REVALIDATED"),h.end("This page could not be found"),null;let B=await te(ae);x.fetchMetrics=y.renderOpts.fetchMetrics;let De=y.renderOpts.pendingWaitUntil;De&&m.waitUntil&&(m.waitUntil(De),De=void 0);let $e=y.renderOpts.collectedTags;if(!L)return await(0,Ue.I)(P,J,B,y.renderOpts.pendingWaitUntil),null;{let We=await B.blob(),t=(0,Be.Cu)(B.headers);$e&&(t[Le.VC]=$e),!t["content-type"]&&We.type&&(t["content-type"]=We.type);let _=y.renderOpts.collectedRevalidate!==void 0&&!(y.renderOpts.collectedRevalidate>=Le.AR)&&y.renderOpts.collectedRevalidate,T=y.renderOpts.collectedExpire===void 0||y.renderOpts.collectedExpire>=Le.AR?void 0:y.renderOpts.collectedExpire;return{value:{kind:Ne.yD.APP_ROUTE,status:B.status,body:Nt.from(await We.arrayBuffer()),headers:t},cacheControl:{revalidate:_,expire:T}}}}catch(B){throw He?.isStale&&await _e.onRequestError(x,B,{routerKind:"App Router",routePath:j,routeType:"route",revalidateReason:(0,Xe.c)({isRevalidate:f,isOnDemandRevalidate:l})},ye),B}},ne=await _e.handleResponse({req:x,nextConfig:z,cacheKey:A,routeKind:de.A.APP_ROUTE,isFallback:!1,prerenderManifest:$,isRoutePPREnabled:!1,isOnDemandRevalidate:l,revalidateOnlyGenerated:W,responseGenerator:Pe,waitUntil:m.waitUntil});if(!L)return null;if((ne==null||(ie=ne.value)==null?void 0:ie.kind)!==Ne.yD.APP_ROUTE)throw Object.defineProperty(Error(`Invariant: app-route received invalid cache entry ${ne==null||(ke=ne.value)==null?void 0:ke.kind}`),"__NEXT_ERROR_CODE",{value:"E701",enumerable:!1,configurable:!0});(0,pe.Ny)(x,"minimalMode")||h.setHeader("x-nextjs-cache",l?"REVALIDATED":ne.isMiss?"MISS":ne.isStale?"STALE":"HIT"),k&&h.setHeader("Cache-Control","private, no-cache, no-store, max-age=0, must-revalidate");let Re=(0,Be.p$)(ne.value.headers);return(0,pe.Ny)(x,"minimalMode")&&L||Re.delete(Le.VC),!ne.cacheControl||h.getHeader("Cache-Control")||Re.get("Cache-Control")||Re.set("Cache-Control",(0,Qe.B)(ne.cacheControl)),await(0,Ue.I)(P,J,new Response(ne.value.body,{headers:Re,status:ne.value.status||200})),null};p?await xe(p):await C.withPropagatedContext(x.headers,()=>C.trace(Ce.Li.handleRequest,{spanName:`${d} ${x.url}`,kind:Oe.v8.SERVER,attributes:{"http.method":d,"http.target":x.url}},xe))}catch(te){if(p||await _e.onRequestError(x,te,{routerKind:"App Router",routePath:oe,routeType:"route",revalidateReason:(0,Xe.c)({isRevalidate:f,isOnDemandRevalidate:l})}),L)throw te;return await(0,Ue.I)(P,J,new Response(null,{status:500})),null}}let ft=(g=U.__RSC_MANIFEST)==null?void 0:g["/api/generate-ai-code-stream/route"],et=(x=>x?JSON.parse(x):void 0)(U.__RSC_SERVER_MANIFEST);ft&&et&&(0,K.fQ)({page:"/api/generate-ai-code-stream/route",clientReferenceManifest:ft,serverActionsManifest:et,serverModuleMap:(0,ee.e)({serverActionsManifest:et})});let Ct=v,Rt=q.s.wrap(_e,{nextConfig:{env:{},webpack:null,eslint:{ignoreDuringBuilds:!0},typescript:{ignoreBuildErrors:!1,tsconfigPath:"tsconfig.json"},distDir:".next",cleanDistDir:!0,assetPrefix:"",cacheMaxMemorySize:52428800,configOrigin:"next.config.ts",useFileSystemPublicRoutes:!0,generateEtags:!0,pageExtensions:["tsx","ts","jsx","js"],poweredByHeader:!0,compress:!0,images:{deviceSizes:[640,750,828,1080,1200,1920,2048,3840],imageSizes:[16,32,48,64,96,128,256,384],path:"/_next/image",loader:"default",loaderFile:"",domains:[],disableStaticImages:!1,minimumCacheTTL:60,formats:["image/webp"],dangerouslyAllowSVG:!1,contentSecurityPolicy:"script-src 'none'; frame-src 'none'; sandbox;",contentDispositionType:"attachment",remotePatterns:[],unoptimized:!1},devIndicators:{position:"bottom-left"},onDemandEntries:{maxInactiveAge:6e4,pagesBufferLength:5},amp:{canonicalBase:""},basePath:"",sassOptions:{},trailingSlash:!1,i18n:null,productionBrowserSourceMaps:!1,excludeDefaultMomentLocales:!0,serverRuntimeConfig:{},publicRuntimeConfig:{},reactProductionProfiling:!1,reactStrictMode:null,reactMaxHeadersLength:6e3,httpAgentOptions:{keepAlive:!0},logging:{},compiler:{},expireTime:31536e3,staticPageGenerationTimeout:60,modularizeImports:{"@mui/icons-material":{transform:"@mui/icons-material/{{member}}"},lodash:{transform:"lodash/{{member}}"}},outputFileTracingRoot:"/workspace",experimental:{useSkewCookie:!1,nodeMiddleware:!1,cacheLife:{default:{stale:300,revalidate:900,expire:4294967294},seconds:{stale:0,revalidate:1,expire:60},minutes:{stale:300,revalidate:60,expire:3600},hours:{stale:300,revalidate:3600,expire:86400},days:{stale:300,revalidate:86400,expire:604800},weeks:{stale:300,revalidate:604800,expire:2592e3},max:{stale:300,revalidate:2592e3,expire:4294967294}},cacheHandlers:{},cssChunking:!0,multiZoneDraftMode:!1,appNavFailHandling:!1,prerenderEarlyExit:!0,serverMinification:!0,serverSourceMaps:!1,linkNoTouchStart:!1,caseSensitiveRoutes:!1,clientSegmentCache:!1,dynamicOnHover:!1,preloadEntriesOnStart:!0,clientRouterFilter:!0,clientRouterFilterRedirects:!1,fetchCacheKeyPrefix:"",middlewarePrefetch:"flexible",optimisticClientCache:!0,manualClientBasePath:!1,cpus:3,memoryBasedWorkersCount:!1,imgOptConcurrency:null,imgOptTimeoutInSeconds:7,imgOptMaxInputPixels:268402689,imgOptSequentialRead:null,isrFlushToDisk:!0,workerThreads:!1,optimizeCss:!1,nextScriptWorkers:!1,scrollRestoration:!1,externalDir:!1,disableOptimizedLoading:!1,gzipSize:!0,craCompat:!1,esmExternals:!0,fullySpecified:!1,swcTraceProfiling:!1,forceSwcTransforms:!1,largePageDataBytes:128e3,typedRoutes:!1,typedEnv:!1,parallelServerCompiles:!1,parallelServerBuildTraces:!1,ppr:!1,authInterrupts:!1,webpackMemoryOptimizations:!1,optimizeServerReact:!0,viewTransition:!1,routerBFCache:!1,removeUncaughtErrorAndRejectionListeners:!1,validateRSCRequestHeaders:!1,staleTimes:{dynamic:0,static:300},serverComponentsHmrCache:!0,staticGenerationMaxConcurrency:8,staticGenerationMinPagesPerWorker:25,dynamicIO:!1,inlineCss:!1,useCache:!1,globalNotFound:!1,devtoolNewPanelUI:!1,devtoolSegmentExplorer:!1,browserDebugInfoInTerminal:!1,optimizeRouterScrolling:!1,strictNextHead:!0,trustHostHeader:!0,optimizePackageImports:["lucide-react","date-fns","lodash-es","ramda","antd","react-bootstrap","ahooks","@ant-design/icons","@headlessui/react","@headlessui-float/react","@heroicons/react/20/solid","@heroicons/react/24/solid","@heroicons/react/24/outline","@visx/visx","@tremor/react","rxjs","@mui/material","@mui/icons-material","recharts","react-use","effect","@effect/schema","@effect/platform","@effect/platform-node","@effect/platform-browser","@effect/platform-bun","@effect/sql","@effect/sql-mssql","@effect/sql-mysql2","@effect/sql-pg","@effect/sql-sqlite-node","@effect/sql-sqlite-bun","@effect/sql-sqlite-wasm","@effect/sql-sqlite-react-native","@effect/rpc","@effect/rpc-http","@effect/typeclass","@effect/experimental","@effect/opentelemetry","@material-ui/core","@material-ui/icons","@tabler/icons-react","mui-core","react-icons/ai","react-icons/bi","react-icons/bs","react-icons/cg","react-icons/ci","react-icons/di","react-icons/fa","react-icons/fa6","react-icons/fc","react-icons/fi","react-icons/gi","react-icons/go","react-icons/gr","react-icons/hi","react-icons/hi2","react-icons/im","react-icons/io","react-icons/io5","react-icons/lia","react-icons/lib","react-icons/lu","react-icons/md","react-icons/pi","react-icons/ri","react-icons/rx","react-icons/si","react-icons/sl","react-icons/tb","react-icons/tfi","react-icons/ti","react-icons/vsc","react-icons/wi"]},htmlLimitedBots:"Mediapartners-Google|Chrome-Lighthouse|Slurp|DuckDuckBot|baiduspider|yandex|sogou|bitlybot|tumblr|vkShare|quora link preview|redditbot|ia_archiver|Bingbot|BingPreview|applebot|facebookexternalhit|facebookcatalog|Twitterbot|LinkedInBot|Slackbot|Discordbot|WhatsApp|SkypeUriPreview|Yeti",bundlePagesRouterDependencies:!1,configFile:"/workspace/next.config.ts",configFileName:"next.config.ts",turbopack:{root:"/workspace"}}})},5356:$t,5492:Zs,5521:Ht,9127:Yt},Q=>{Q.O(0,[499,464],()=>Q(Q.s=4693));var Z=Q.O();(u._ENTRIES=typeof u._ENTRIES>"u"?{}:u._ENTRIES)["middleware_app/api/generate-ai-code-stream/route"]=Z}]),function(){let Q={exports:{},loaded:!1};return function(n,g){var H=Object.create,v=Object.defineProperty,ee=Object.getOwnPropertyDescriptor,K=Object.getOwnPropertyNames,q=Object.getPrototypeOf,ce=Object.prototype.hasOwnProperty,de=a=>v(a,"__esModule",{value:!0}),ue=(a,D)=>{de(a);for(var b in D)v(a,b,{get:D[b],enumerable:!0})},pe=(a,D,b)=>{if(D&&typeof D=="object"||typeof D=="function")for(let N of K(D))!ce.call(a,N)&&N!=="default"&&v(a,N,{get:()=>D[N],enumerable:!(b=ee(D,N))||b.enumerable});return a},Oe=a=>pe(de(v(a!=null?H(q(a)):{},"default",a&&a.__esModule&&"default"in a?{get:()=>a.default,enumerable:!0}:{value:a,enumerable:!0})),a);ue(g,{default:()=>Ze});var Fe=Oe((xt(),Dt(Ge))),Ie="@next/request-context",ve=Symbol.for(Ie),Ce=Symbol.for("internal.storage");function Xe(){let a=u;if(!a[ve]){let D=new Fe.AsyncLocalStorage,b={get:()=>D.getStore(),[Ce]:D};a[ve]=b}return a[ve]}var Ue=Xe();function Be(a,D){return Ue[Ce].run(a,D)}function Qe(a){let D={};return a&&a.forEach((b,N)=>{D[N]=b,N.toLowerCase()==="set-cookie"&&(D[N]=Le(b))}),D}function Le(a){let D=[],b=0,N,R,V,Ee,we;function le(){for(;b<a.length&&/\s/.test(a.charAt(b));)b+=1;return b<a.length}function fe(){return R=a.charAt(b),R!=="="&&R!==";"&&R!==","}for(;b<a.length;){for(N=b,we=!1;le();)if(R=a.charAt(b),R===","){for(V=b,b+=1,le(),Ee=b;b<a.length&&fe();)b+=1;b<a.length&&a.charAt(b)==="="?(we=!0,b=Ee,D.push(a.substring(N,V)),N=b):b=V+1}else b+=1;(!we||b>=a.length)&&D.push(a.substring(N,a.length))}return D}function Ze(a){let D=a.staticRoutes.map(N=>({regexp:new RegExp(N.namedRegex),page:N.page})),b=a.dynamicRoutes?.map(N=>({regexp:new RegExp(N.namedRegex),page:N.page}))||[];return async function(N,R){let V=new URL(N.url).pathname,Ee={};if(a.nextConfig?.basePath&&V.startsWith(a.nextConfig.basePath)&&(V=V.replace(a.nextConfig.basePath,"")||"/"),a.nextConfig?.i18n)for(let le of a.nextConfig.i18n.locales){let fe=new RegExp(`^/${le}($|/)`,"i");if(V.match(fe)){V=V.replace(fe,"/")||"/";break}}for(let le of D)if(le.regexp.exec(V)){Ee.name=le.page;break}if(!Ee.name){let le=Me(V);for(let fe of b||[]){if(le&&!Me(fe.page))continue;let Ye=fe.regexp.exec(V);if(Ye){Ee={name:fe.page,params:Ye.groups};break}}}let we=await Be({waitUntil:R.waitUntil},()=>u._ENTRIES[`middleware_${a.name}`].default.call({},{request:{url:N.url,method:N.method,headers:Qe(N.headers),ip:Ne(N.headers,ge.Ip),geo:{city:Ne(N.headers,ge.City,!0),country:Ne(N.headers,ge.Country,!0),latitude:Ne(N.headers,ge.Latitude),longitude:Ne(N.headers,ge.Longitude),region:Ne(N.headers,ge.Region,!0)},nextConfig:a.nextConfig,page:Ee,body:N.body}}));return we.waitUntil&&R.waitUntil(we.waitUntil),we.response}}function Ne(a,D,b=!1){let N=a.get(D)||void 0;return b&&N?decodeURIComponent(N):N}function Me(a){return a==="/api"||a.startsWith("/api/")}var ge;(function(a){a.City="x-vercel-ip-city",a.Country="x-vercel-ip-country",a.Ip="x-real-ip",a.Latitude="x-vercel-ip-latitude",a.Longitude="x-vercel-ip-longitude",a.Region="x-vercel-ip-country-region"})(ge||(ge={}))}(Q,Q.exports),Q.exports}.call({}).default({name:"app/api/generate-ai-code-stream/route",staticRoutes:[{page:"/",regex:"^/(?:/)?$",routeKeys:{},namedRegex:"^/(?:/)?$"},{page:"/_not-found",regex:"^/_not\\-found(?:/)?$",routeKeys:{},namedRegex:"^/_not\\-found(?:/)?$"},{page:"/favicon.ico",regex:"^/favicon\\.ico(?:/)?$",routeKeys:{},namedRegex:"^/favicon\\.ico(?:/)?$"}],dynamicRoutes:[],nextConfig:{basePath:""}})))(se,se,se);export{Do as default};
